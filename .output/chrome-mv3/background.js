var background=(function(){"use strict";var dc=Object.defineProperty;var fc=(Ee,de,fe)=>de in Ee?dc(Ee,de,{enumerable:!0,configurable:!0,writable:!0,value:fe}):Ee[de]=fe;var zt=(Ee,de,fe)=>fc(Ee,typeof de!="symbol"?de+"":de,fe);var $a,Ma;function Ee(s){return s==null||typeof s=="function"?{main:s}:s}function de(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var fe={exports:{}},ka=fe.exports,ms;function Na(){return ms||(ms=1,(function(s,e){(function(t,n){n(s)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:ka,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const n="The message port closed before a response was received.",r=a=>{const i={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(i).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(p,v=void 0){super(v),this.createItem=p}get(p){return this.has(p)||this.set(p,this.createItem(p)),super.get(p)}}const d=m=>m&&typeof m=="object"&&typeof m.then=="function",h=(m,p)=>(...v)=>{a.runtime.lastError?m.reject(new Error(a.runtime.lastError.message)):p.singleCallbackArg||v.length<=1&&p.singleCallbackArg!==!1?m.resolve(v[0]):m.resolve(v)},b=m=>m==1?"argument":"arguments",g=(m,p)=>function(C,...S){if(S.length<p.minArgs)throw new Error(`Expected at least ${p.minArgs} ${b(p.minArgs)} for ${m}(), got ${S.length}`);if(S.length>p.maxArgs)throw new Error(`Expected at most ${p.maxArgs} ${b(p.maxArgs)} for ${m}(), got ${S.length}`);return new Promise(($,M)=>{if(p.fallbackToNoCallback)try{C[m](...S,h({resolve:$,reject:M},p))}catch(P){console.warn(`${m} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,P),C[m](...S),p.fallbackToNoCallback=!1,p.noCallback=!0,$()}else p.noCallback?(C[m](...S),$()):C[m](...S,h({resolve:$,reject:M},p))})},A=(m,p,v)=>new Proxy(p,{apply(C,S,$){return v.call(S,m,...$)}});let w=Function.call.bind(Object.prototype.hasOwnProperty);const x=(m,p={},v={})=>{let C=Object.create(null),S={has(M,P){return P in m||P in C},get(M,P,D){if(P in C)return C[P];if(!(P in m))return;let N=m[P];if(typeof N=="function")if(typeof p[P]=="function")N=A(m,m[P],p[P]);else if(w(v,P)){let ve=g(P,v[P]);N=A(m,m[P],ve)}else N=N.bind(m);else if(typeof N=="object"&&N!==null&&(w(p,P)||w(v,P)))N=x(N,p[P],v[P]);else if(w(v,"*"))N=x(N,p[P],v["*"]);else return Object.defineProperty(C,P,{configurable:!0,enumerable:!0,get(){return m[P]},set(ve){m[P]=ve}}),N;return C[P]=N,N},set(M,P,D,N){return P in C?C[P]=D:m[P]=D,!0},defineProperty(M,P,D){return Reflect.defineProperty(C,P,D)},deleteProperty(M,P){return Reflect.deleteProperty(C,P)}},$=Object.create(m);return new Proxy($,S)},l=m=>({addListener(p,v,...C){p.addListener(m.get(v),...C)},hasListener(p,v){return p.hasListener(m.get(v))},removeListener(p,v){p.removeListener(m.get(v))}}),c=new o(m=>typeof m!="function"?m:function(v){const C=x(v,{},{getContent:{minArgs:0,maxArgs:0}});m(C)}),f=new o(m=>typeof m!="function"?m:function(v,C,S){let $=!1,M,P=new Promise(ne=>{M=function(ee){$=!0,ne(ee)}}),D;try{D=m(v,C,M)}catch(ne){D=Promise.reject(ne)}const N=D!==!0&&d(D);if(D!==!0&&!N&&!$)return!1;const ve=ne=>{ne.then(ee=>{S(ee)},ee=>{let Ce;ee&&(ee instanceof Error||typeof ee.message=="string")?Ce=ee.message:Ce="An unexpected error occurred",S({__mozWebExtensionPolyfillReject__:!0,message:Ce})}).catch(ee=>{console.error("Failed to send onMessage rejected reply",ee)})};return ve(N?D:P),!0}),u=({reject:m,resolve:p},v)=>{a.runtime.lastError?a.runtime.lastError.message===n?p():m(new Error(a.runtime.lastError.message)):v&&v.__mozWebExtensionPolyfillReject__?m(new Error(v.message)):p(v)},_=(m,p,v,...C)=>{if(C.length<p.minArgs)throw new Error(`Expected at least ${p.minArgs} ${b(p.minArgs)} for ${m}(), got ${C.length}`);if(C.length>p.maxArgs)throw new Error(`Expected at most ${p.maxArgs} ${b(p.maxArgs)} for ${m}(), got ${C.length}`);return new Promise((S,$)=>{const M=u.bind(null,{resolve:S,reject:$});C.push(M),v.sendMessage(...C)})},y={devtools:{network:{onRequestFinished:l(c)}},runtime:{onMessage:l(f),onMessageExternal:l(f),sendMessage:_.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:_.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},I={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return i.privacy={network:{"*":I},services:{"*":I},websites:{"*":I}},x(a,y,i)};t.exports=r(chrome)}})})(fe)),fe.exports}var La=Na();const X=de(La);var ps;(function(s){s.STRING="string",s.NUMBER="number",s.INTEGER="integer",s.BOOLEAN="boolean",s.ARRAY="array",s.OBJECT="object"})(ps||(ps={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ws;(function(s){s.LANGUAGE_UNSPECIFIED="language_unspecified",s.PYTHON="python"})(ws||(ws={}));var _s;(function(s){s.OUTCOME_UNSPECIFIED="outcome_unspecified",s.OUTCOME_OK="outcome_ok",s.OUTCOME_FAILED="outcome_failed",s.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(_s||(_s={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ys=["user","model","function","system"];var As;(function(s){s.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",s.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",s.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",s.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",s.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"})(As||(As={}));var bs;(function(s){s.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE"})(bs||(bs={}));var xs;(function(s){s.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",s.NEGLIGIBLE="NEGLIGIBLE",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH"})(xs||(xs={}));var vs;(function(s){s.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",s.SAFETY="SAFETY",s.OTHER="OTHER"})(vs||(vs={}));var Ke;(function(s){s.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",s.STOP="STOP",s.MAX_TOKENS="MAX_TOKENS",s.SAFETY="SAFETY",s.RECITATION="RECITATION",s.LANGUAGE="LANGUAGE",s.OTHER="OTHER"})(Ke||(Ke={}));var Cs;(function(s){s.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",s.RETRIEVAL_QUERY="RETRIEVAL_QUERY",s.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",s.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",s.CLASSIFICATION="CLASSIFICATION",s.CLUSTERING="CLUSTERING"})(Cs||(Cs={}));var Es;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.AUTO="AUTO",s.ANY="ANY",s.NONE="NONE"})(Es||(Es={}));var Ss;(function(s){s.MODE_UNSPECIFIED="MODE_UNSPECIFIED",s.MODE_DYNAMIC="MODE_DYNAMIC"})(Ss||(Ss={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class $e extends W{constructor(e,t){super(e),this.response=t}}class Rs extends W{constructor(e,t,n,r){super(e),this.status=t,this.statusText=n,this.errorDetails=r}}class me extends W{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fa="https://generativelanguage.googleapis.com",Da="v1beta",Ba="0.21.0",Ua="genai-js";var Se;(function(s){s.GENERATE_CONTENT="generateContent",s.STREAM_GENERATE_CONTENT="streamGenerateContent",s.COUNT_TOKENS="countTokens",s.EMBED_CONTENT="embedContent",s.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Se||(Se={}));class ja{constructor(e,t,n,r,a){this.model=e,this.task=t,this.apiKey=n,this.stream=r,this.requestOptions=a}toString(){var e,t;const n=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Da;let a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Fa}/${n}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function Va(s){const e=[];return s!=null&&s.apiClient&&e.push(s.apiClient),e.push(`${Ua}/${Ba}`),e.join(" ")}async function Ga(s){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",Va(s.requestOptions)),t.append("x-goog-api-key",s.apiKey);let n=(e=s.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(r){throw new me(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${r.message}`)}for(const[r,a]of n.entries()){if(r==="x-goog-api-key")throw new me(`Cannot set reserved header name ${r}`);if(r==="x-goog-api-client")throw new me(`Header name ${r} can only be set using the apiClient field`);t.append(r,a)}}return t}async function Ha(s,e,t,n,r,a){const i=new ja(s,e,t,n,a);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},Ja(a)),{method:"POST",headers:await Ga(i),body:r})}}async function We(s,e,t,n,r,a={},i=fetch){const{url:o,fetchOptions:d}=await Ha(s,e,t,n,r,a);return qa(o,d,i)}async function qa(s,e,t=fetch){let n;try{n=await t(s,e)}catch(r){Ka(r,s)}return n.ok||await Wa(n,s),n}function Ka(s,e){let t=s;throw s instanceof Rs||s instanceof me||(t=new W(`Error fetching from ${e.toString()}: ${s.message}`),t.stack=s.stack),t}async function Wa(s,e){let t="",n;try{const r=await s.json();t=r.error.message,r.error.details&&(t+=` ${JSON.stringify(r.error.details)}`,n=r.error.details)}catch{}throw new Rs(`Error fetching from ${e.toString()}: [${s.status} ${s.statusText}] ${t}`,s.status,s.statusText,n)}function Ja(s){const e={};if((s==null?void 0:s.signal)!==void 0||(s==null?void 0:s.timeout)>=0){const t=new AbortController;(s==null?void 0:s.timeout)>=0&&setTimeout(()=>t.abort(),s.timeout),s!=null&&s.signal&&s.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qt(s){return s.text=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),gt(s.candidates[0]))throw new $e(`${pe(s)}`,s);return Xa(s)}else if(s.promptFeedback)throw new $e(`Text not available. ${pe(s)}`,s);return""},s.functionCall=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),gt(s.candidates[0]))throw new $e(`${pe(s)}`,s);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),Is(s)[0]}else if(s.promptFeedback)throw new $e(`Function call not available. ${pe(s)}`,s)},s.functionCalls=()=>{if(s.candidates&&s.candidates.length>0){if(s.candidates.length>1&&console.warn(`This response had ${s.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),gt(s.candidates[0]))throw new $e(`${pe(s)}`,s);return Is(s)}else if(s.promptFeedback)throw new $e(`Function call not available. ${pe(s)}`,s)},s}function Xa(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const i of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)i.text&&a.push(i.text),i.executableCode&&a.push("\n```"+i.executableCode.language+`
`+i.executableCode.code+"\n```\n"),i.codeExecutionResult&&a.push("\n```\n"+i.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function Is(s){var e,t,n,r;const a=[];if(!((t=(e=s.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const i of(r=(n=s.candidates)===null||n===void 0?void 0:n[0].content)===null||r===void 0?void 0:r.parts)i.functionCall&&a.push(i.functionCall);if(a.length>0)return a}const Ya=[Ke.RECITATION,Ke.SAFETY,Ke.LANGUAGE];function gt(s){return!!s.finishReason&&Ya.includes(s.finishReason)}function pe(s){var e,t,n;let r="";if((!s.candidates||s.candidates.length===0)&&s.promptFeedback)r+="Response was blocked",!((e=s.promptFeedback)===null||e===void 0)&&e.blockReason&&(r+=` due to ${s.promptFeedback.blockReason}`),!((t=s.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(r+=`: ${s.promptFeedback.blockReasonMessage}`);else if(!((n=s.candidates)===null||n===void 0)&&n[0]){const a=s.candidates[0];gt(a)&&(r+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(r+=`: ${a.finishMessage}`))}return r}function Je(s){return this instanceof Je?(this.v=s,this):new Je(s)}function za(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(s,e||[]),r,a=[];return r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r;function i(A){n[A]&&(r[A]=function(w){return new Promise(function(x,l){a.push([A,w,x,l])>1||o(A,w)})})}function o(A,w){try{d(n[A](w))}catch(x){g(a[0][3],x)}}function d(A){A.value instanceof Je?Promise.resolve(A.value.v).then(h,b):g(a[0][2],A)}function h(A){o("next",A)}function b(A){o("throw",A)}function g(A,w){A(w),a.shift(),a.length&&o(a[0][0],a[0][1])}}typeof SuppressedError=="function"&&SuppressedError;/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Os=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Qa(s){const e=s.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=ti(e),[n,r]=t.tee();return{stream:ei(n),response:Za(r)}}async function Za(s){const e=[],t=s.getReader();for(;;){const{done:n,value:r}=await t.read();if(n)return Qt(ni(e));e.push(r)}}function ei(s){return za(this,arguments,function*(){const t=s.getReader();for(;;){const{value:n,done:r}=yield Je(t.read());if(r)break;yield yield Je(Qt(n))}})}function ti(s){const e=s.getReader();return new ReadableStream({start(n){let r="";return a();function a(){return e.read().then(({value:i,done:o})=>{if(o){if(r.trim()){n.error(new W("Failed to parse stream"));return}n.close();return}r+=i;let d=r.match(Os),h;for(;d;){try{h=JSON.parse(d[1])}catch{n.error(new W(`Error parsing JSON response: "${d[1]}"`));return}n.enqueue(h),r=r.substring(d[0].length),d=r.match(Os)}return a()})}}})}function ni(s){const e=s[s.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const n of s){if(n.candidates)for(const r of n.candidates){const a=r.index;if(t.candidates||(t.candidates=[]),t.candidates[a]||(t.candidates[a]={index:r.index}),t.candidates[a].citationMetadata=r.citationMetadata,t.candidates[a].groundingMetadata=r.groundingMetadata,t.candidates[a].finishReason=r.finishReason,t.candidates[a].finishMessage=r.finishMessage,t.candidates[a].safetyRatings=r.safetyRatings,r.content&&r.content.parts){t.candidates[a].content||(t.candidates[a].content={role:r.content.role||"user",parts:[]});const i={};for(const o of r.content.parts)o.text&&(i.text=o.text),o.functionCall&&(i.functionCall=o.functionCall),o.executableCode&&(i.executableCode=o.executableCode),o.codeExecutionResult&&(i.codeExecutionResult=o.codeExecutionResult),Object.keys(i).length===0&&(i.text=""),t.candidates[a].content.parts.push(i)}}n.usageMetadata&&(t.usageMetadata=n.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ps(s,e,t,n){const r=await We(e,Se.STREAM_GENERATE_CONTENT,s,!0,JSON.stringify(t),n);return Qa(r)}async function Ts(s,e,t,n){const a=await(await We(e,Se.GENERATE_CONTENT,s,!1,JSON.stringify(t),n)).json();return{response:Qt(a)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $s(s){if(s!=null){if(typeof s=="string")return{role:"system",parts:[{text:s}]};if(s.text)return{role:"system",parts:[s]};if(s.parts)return s.role?s:{role:"system",parts:s.parts}}}function Xe(s){let e=[];if(typeof s=="string")e=[{text:s}];else for(const t of s)typeof t=="string"?e.push({text:t}):e.push(t);return si(e)}function si(s){const e={role:"user",parts:[]},t={role:"function",parts:[]};let n=!1,r=!1;for(const a of s)"functionResponse"in a?(t.parts.push(a),r=!0):(e.parts.push(a),n=!0);if(n&&r)throw new W("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!r)throw new W("No content is provided for sending chat message.");return n?e:t}function ri(s,e){var t;let n={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const r=s.generateContentRequest!=null;if(s.contents){if(r)throw new me("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=s.contents}else if(r)n=Object.assign(Object.assign({},n),s.generateContentRequest);else{const a=Xe(s);n.contents=[a]}return{generateContentRequest:n}}function Ms(s){let e;return s.contents?e=s:e={contents:[Xe(s)]},s.systemInstruction&&(e.systemInstruction=$s(s.systemInstruction)),e}function ai(s){return typeof s=="string"||Array.isArray(s)?{content:Xe(s)}:s}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ks=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],ii={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function oi(s){let e=!1;for(const t of s){const{role:n,parts:r}=t;if(!e&&n!=="user")throw new W(`First content should be with role 'user', got ${n}`);if(!ys.includes(n))throw new W(`Each item should include role field. Got ${n} but valid roles are: ${JSON.stringify(ys)}`);if(!Array.isArray(r))throw new W("Content should have 'parts' property with an array of Parts");if(r.length===0)throw new W("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const o of r)for(const d of ks)d in o&&(a[d]+=1);const i=ii[n];for(const o of ks)if(!i.includes(o)&&a[o]>0)throw new W(`Content with role '${n}' can't contain '${o}' part`);e=!0}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ns="SILENT_ERROR";class ci{constructor(e,t,n,r={}){this.model=t,this.params=n,this._requestOptions=r,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,n!=null&&n.history&&(oi(n.history),this._history=n.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var n,r,a,i,o,d;await this._sendPromise;const h=Xe(e),b={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(d=this.params)===null||d===void 0?void 0:d.cachedContent,contents:[...this._history,h]},g=Object.assign(Object.assign({},this._requestOptions),t);let A;return this._sendPromise=this._sendPromise.then(()=>Ts(this._apiKey,this.model,b,g)).then(w=>{var x;if(w.response.candidates&&w.response.candidates.length>0){this._history.push(h);const l=Object.assign({parts:[],role:"model"},(x=w.response.candidates)===null||x===void 0?void 0:x[0].content);this._history.push(l)}else{const l=pe(w.response);l&&console.warn(`sendMessage() was unsuccessful. ${l}. Inspect response object for details.`)}A=w}),await this._sendPromise,A}async sendMessageStream(e,t={}){var n,r,a,i,o,d;await this._sendPromise;const h=Xe(e),b={safetySettings:(n=this.params)===null||n===void 0?void 0:n.safetySettings,generationConfig:(r=this.params)===null||r===void 0?void 0:r.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(i=this.params)===null||i===void 0?void 0:i.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(d=this.params)===null||d===void 0?void 0:d.cachedContent,contents:[...this._history,h]},g=Object.assign(Object.assign({},this._requestOptions),t),A=Ps(this._apiKey,this.model,b,g);return this._sendPromise=this._sendPromise.then(()=>A).catch(w=>{throw new Error(Ns)}).then(w=>w.response).then(w=>{if(w.candidates&&w.candidates.length>0){this._history.push(h);const x=Object.assign({},w.candidates[0].content);x.role||(x.role="model"),this._history.push(x)}else{const x=pe(w);x&&console.warn(`sendMessageStream() was unsuccessful. ${x}. Inspect response object for details.`)}}).catch(w=>{w.message!==Ns&&console.error(w)}),A}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function li(s,e,t,n){return(await We(e,Se.COUNT_TOKENS,s,!1,JSON.stringify(t),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ui(s,e,t,n){return(await We(e,Se.EMBED_CONTENT,s,!1,JSON.stringify(t),n)).json()}async function di(s,e,t,n){const r=t.requests.map(i=>Object.assign(Object.assign({},i),{model:e}));return(await We(e,Se.BATCH_EMBED_CONTENTS,s,!1,JSON.stringify({requests:r}),n)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ls{constructor(e,t,n={}){this.apiKey=e,this._requestOptions=n,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=$s(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var n;const r=Ms(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Ts(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}async generateContentStream(e,t={}){var n;const r=Ms(e),a=Object.assign(Object.assign({},this._requestOptions),t);return Ps(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(n=this.cachedContent)===null||n===void 0?void 0:n.name},r),a)}startChat(e){var t;return new ci(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const n=ri(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),r=Object.assign(Object.assign({},this._requestOptions),t);return li(this.apiKey,this.model,n,r)}async embedContent(e,t={}){const n=ai(e),r=Object.assign(Object.assign({},this._requestOptions),t);return ui(this.apiKey,this.model,n,r)}async batchEmbedContents(e,t={}){const n=Object.assign(Object.assign({},this._requestOptions),t);return di(this.apiKey,this.model,e,n)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new W("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new Ls(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,n){if(!e.name)throw new me("Cached content must contain a `name` field.");if(!e.model)throw new me("Cached content must contain a `model` field.");const r=["model","systemInstruction"];for(const i of r)if(t!=null&&t[i]&&e[i]&&(t==null?void 0:t[i])!==e[i]){if(i==="model"){const o=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,d=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===d)continue}throw new me(`Different value for "${i}" specified in modelParams (${t[i]}) and cachedContent (${e[i]})`)}const a=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new Ls(this.apiKey,a,n)}}var Fs=Object.prototype.hasOwnProperty;function Zt(s,e){var t,n;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((n=s.length)===e.length)for(;n--&&Zt(s[n],e[n]););return n===-1}if(!t||typeof s=="object"){n=0;for(t in s)if(Fs.call(s,t)&&++n&&!Fs.call(e,t)||!(t in e)||!Zt(s[t],e[t]))return!1;return Object.keys(e).length===n}}return s!==s&&e!==e}const hi=new Error("request for lock canceled");var gi=function(s,e,t,n){function r(a){return a instanceof t?a:new t(function(i){i(a)})}return new(t||(t=Promise))(function(a,i){function o(b){try{h(n.next(b))}catch(g){i(g)}}function d(b){try{h(n.throw(b))}catch(g){i(g)}}function h(b){b.done?a(b.value):r(b.value).then(o,d)}h((n=n.apply(s,e||[])).next())})};class mi{constructor(e,t=hi){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((n,r)=>{const a={resolve:n,reject:r,weight:e,priority:t},i=Ds(this._queue,o=>t<=o.priority);i===-1&&e<=this._value?this._dispatchItem(a):this._queue.splice(i+1,0,a)})}runExclusive(e){return gi(this,arguments,void 0,function*(t,n=1,r=0){const[a,i]=yield this.acquire(n,r);try{return yield t(a)}finally{i()}})}waitForUnlock(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(n=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),pi(this._weightedWaiters[e-1],{resolve:n,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){const t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){const t=this._weightedWaiters[e-1];t&&(t.forEach(n=>n.resolve()),this._weightedWaiters[e-1]=[])}else{const e=this._queue[0].priority;for(let t=this._value;t>0;t--){const n=this._weightedWaiters[t-1];if(!n)continue;const r=n.findIndex(a=>a.priority<=e);(r===-1?n:n.splice(0,r)).forEach((a=>a.resolve()))}}}_couldLockImmediately(e,t){return(this._queue.length===0||this._queue[0].priority<t)&&e<=this._value}}function pi(s,e){const t=Ds(s,n=>e.priority<=n.priority);s.splice(t+1,0,e)}function Ds(s,e){for(let t=s.length-1;t>=0;t--)if(e(s[t]))return t;return-1}var wi=function(s,e,t,n){function r(a){return a instanceof t?a:new t(function(i){i(a)})}return new(t||(t=Promise))(function(a,i){function o(b){try{h(n.next(b))}catch(g){i(g)}}function d(b){try{h(n.throw(b))}catch(g){i(g)}}function h(b){b.done?a(b.value):r(b.value).then(o,d)}h((n=n.apply(s,e||[])).next())})};class _i{constructor(e){this._semaphore=new mi(1,e)}acquire(){return wi(this,arguments,void 0,function*(e=0){const[,t]=yield this._semaphore.acquire(1,e);return t})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const mt=(Ma=($a=globalThis.browser)==null?void 0:$a.runtime)!=null&&Ma.id?globalThis.browser:globalThis.chrome,se=yi();function yi(){const s={local:pt("local"),session:pt("session"),sync:pt("sync"),managed:pt("managed")},e=l=>{const c=s[l];if(c==null){const f=Object.keys(s).join(", ");throw Error(`Invalid area "${l}". Options: ${f}`)}return c},t=l=>{const c=l.indexOf(":"),f=l.substring(0,c),u=l.substring(c+1);if(u==null)throw Error(`Storage key should be in the form of "area:key", but received "${l}"`);return{driverArea:f,driverKey:u,driver:e(f)}},n=l=>l+"$",r=(l,c)=>{const f={...l};return Object.entries(c).forEach(([u,_])=>{_==null?delete f[u]:f[u]=_}),f},a=(l,c)=>l??c??null,i=l=>typeof l=="object"&&!Array.isArray(l)?l:{},o=async(l,c,f)=>{const u=await l.getItem(c);return a(u,(f==null?void 0:f.fallback)??(f==null?void 0:f.defaultValue))},d=async(l,c)=>{const f=n(c),u=await l.getItem(f);return i(u)},h=async(l,c,f)=>{await l.setItem(c,f??null)},b=async(l,c,f)=>{const u=n(c),_=i(await l.getItem(u));await l.setItem(u,r(_,f))},g=async(l,c,f)=>{if(await l.removeItem(c),f!=null&&f.removeMeta){const u=n(c);await l.removeItem(u)}},A=async(l,c,f)=>{const u=n(c);if(f==null)await l.removeItem(u);else{const _=i(await l.getItem(u));[f].flat().forEach(y=>delete _[y]),await l.setItem(u,_)}},w=(l,c,f)=>l.watch(c,f);return{getItem:async(l,c)=>{const{driver:f,driverKey:u}=t(l);return await o(f,u,c)},getItems:async l=>{const c=new Map,f=new Map,u=[];l.forEach(y=>{let I,m;typeof y=="string"?I=y:"getValue"in y?(I=y.key,m={fallback:y.fallback}):(I=y.key,m=y.options),u.push(I);const{driverArea:p,driverKey:v}=t(I),C=c.get(p)??[];c.set(p,C.concat(v)),f.set(I,m)});const _=new Map;return await Promise.all(Array.from(c.entries()).map(async([y,I])=>{(await s[y].getItems(I)).forEach(p=>{const v=`${y}:${p.key}`,C=f.get(v),S=a(p.value,(C==null?void 0:C.fallback)??(C==null?void 0:C.defaultValue));_.set(v,S)})})),u.map(y=>({key:y,value:_.get(y)}))},getMeta:async l=>{const{driver:c,driverKey:f}=t(l);return await d(c,f)},getMetas:async l=>{const c=l.map(_=>{const y=typeof _=="string"?_:_.key,{driverArea:I,driverKey:m}=t(y);return{key:y,driverArea:I,driverKey:m,driverMetaKey:n(m)}}),f=c.reduce((_,y)=>{var I;return _[I=y.driverArea]??(_[I]=[]),_[y.driverArea].push(y),_},{}),u={};return await Promise.all(Object.entries(f).map(async([_,y])=>{const I=await mt.storage[_].get(y.map(m=>m.driverMetaKey));y.forEach(m=>{u[m.key]=I[m.driverMetaKey]??{}})})),c.map(_=>({key:_.key,meta:u[_.key]}))},setItem:async(l,c)=>{const{driver:f,driverKey:u}=t(l);await h(f,u,c)},setItems:async l=>{const c={};l.forEach(f=>{const{driverArea:u,driverKey:_}=t("key"in f?f.key:f.item.key);c[u]??(c[u]=[]),c[u].push({key:_,value:f.value})}),await Promise.all(Object.entries(c).map(async([f,u])=>{await e(f).setItems(u)}))},setMeta:async(l,c)=>{const{driver:f,driverKey:u}=t(l);await b(f,u,c)},setMetas:async l=>{const c={};l.forEach(f=>{const{driverArea:u,driverKey:_}=t("key"in f?f.key:f.item.key);c[u]??(c[u]=[]),c[u].push({key:_,properties:f.meta})}),await Promise.all(Object.entries(c).map(async([f,u])=>{const _=e(f),y=u.map(({key:v})=>n(v)),I=await _.getItems(y),m=Object.fromEntries(I.map(({key:v,value:C})=>[v,i(C)])),p=u.map(({key:v,properties:C})=>{const S=n(v);return{key:S,value:r(m[S]??{},C)}});await _.setItems(p)}))},removeItem:async(l,c)=>{const{driver:f,driverKey:u}=t(l);await g(f,u,c)},removeItems:async l=>{const c={};l.forEach(f=>{let u,_;typeof f=="string"?u=f:"getValue"in f?u=f.key:"item"in f?(u=f.item.key,_=f.options):(u=f.key,_=f.options);const{driverArea:y,driverKey:I}=t(u);c[y]??(c[y]=[]),c[y].push(I),_!=null&&_.removeMeta&&c[y].push(n(I))}),await Promise.all(Object.entries(c).map(async([f,u])=>{await e(f).removeItems(u)}))},clear:async l=>{await e(l).clear()},removeMeta:async(l,c)=>{const{driver:f,driverKey:u}=t(l);await A(f,u,c)},snapshot:async(l,c)=>{var _;const u=await e(l).snapshot();return(_=c==null?void 0:c.excludeKeys)==null||_.forEach(y=>{delete u[y],delete u[n(y)]}),u},restoreSnapshot:async(l,c)=>{await e(l).restoreSnapshot(c)},watch:(l,c)=>{const{driver:f,driverKey:u}=t(l);return w(f,u,c)},unwatch(){Object.values(s).forEach(l=>{l.unwatch()})},defineItem:(l,c)=>{const{driver:f,driverKey:u}=t(l),{version:_=1,migrations:y={},onMigrationComplete:I,debug:m=!1}=c??{};if(_<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const p=async()=>{var ee;const M=n(u),[{value:P},{value:D}]=await f.getItems([u,M]);if(P==null)return;const N=(D==null?void 0:D.v)??1;if(N>_)throw Error(`Version downgrade detected (v${N} -> v${_}) for "${l}"`);if(N===_)return;m===!0&&console.debug(`[@wxt-dev/storage] Running storage migration for ${l}: v${N} -> v${_}`);const ve=Array.from({length:_-N},(Ce,gs)=>N+gs+1);let ne=P;for(const Ce of ve)try{ne=await((ee=y==null?void 0:y[Ce])==null?void 0:ee.call(y,ne))??ne,m===!0&&console.debug(`[@wxt-dev/storage] Storage migration processed for version: v${Ce}`)}catch(gs){throw new Ai(l,Ce,{cause:gs})}await f.setItems([{key:u,value:ne},{key:M,value:{...D,v:_}}]),m===!0&&console.debug(`[@wxt-dev/storage] Storage migration completed for ${l} v${_}`,{migratedValue:ne}),I==null||I(ne,_)},v=(c==null?void 0:c.migrations)==null?Promise.resolve():p().catch(M=>{console.error(`[@wxt-dev/storage] Migration failed for ${l}`,M)}),C=new _i,S=()=>(c==null?void 0:c.fallback)??(c==null?void 0:c.defaultValue)??null,$=()=>C.runExclusive(async()=>{const M=await f.getItem(u);if(M!=null||(c==null?void 0:c.init)==null)return M;const P=await c.init();return await f.setItem(u,P),P});return v.then($),{key:l,get defaultValue(){return S()},get fallback(){return S()},getValue:async()=>(await v,c!=null&&c.init?await $():await o(f,u,c)),getMeta:async()=>(await v,await d(f,u)),setValue:async M=>(await v,await h(f,u,M)),setMeta:async M=>(await v,await b(f,u,M)),removeValue:async M=>(await v,await g(f,u,M)),removeMeta:async M=>(await v,await A(f,u,M)),watch:M=>w(f,u,(P,D)=>M(P??S(),D??S())),migrate:p}}}}function pt(s){const e=()=>{if(mt.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if(mt.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const n=mt.storage[s];if(n==null)throw Error(`"browser.storage.${s}" is undefined`);return n},t=new Set;return{getItem:async n=>(await e().get(n))[n],getItems:async n=>{const r=await e().get(n);return n.map(a=>({key:a,value:r[a]??null}))},setItem:async(n,r)=>{r==null?await e().remove(n):await e().set({[n]:r})},setItems:async n=>{const r=n.reduce((a,{key:i,value:o})=>(a[i]=o,a),{});await e().set(r)},removeItem:async n=>{await e().remove(n)},removeItems:async n=>{await e().remove(n)},clear:async()=>{await e().clear()},snapshot:async()=>await e().get(),restoreSnapshot:async n=>{await e().set(n)},watch(n,r){const a=i=>{const o=i[n];o!=null&&(Zt(o.newValue,o.oldValue)||r(o.newValue??null,o.oldValue??null))};return e().onChanged.addListener(a),t.add(a),()=>{e().onChanged.removeListener(a),t.delete(a)}},unwatch(){t.forEach(n=>{e().onChanged.removeListener(n)}),t.clear()}}}class Ai extends Error{constructor(e,t,n){super(`v${t} migration failed for "${e}"`,n),this.key=e,this.version=t}}const Bs={debug:0,info:1,warn:2,error:3},bi={api:"#10b981",selector:"#f59e0b",storage:"#6366f1",ai:"#8b5cf6",scan:"#06b6d4",auth:"#ec4899",extension:"#3b82f6",ui:"#84cc16",general:"#6b7280"},Us={api:"ðŸŒ",selector:"ðŸ”",storage:"ðŸ’¾",ai:"ðŸ¤–",scan:"ðŸ“¡",auth:"ðŸ”",extension:"ðŸ§©",ui:"ðŸŽ¨",general:"ðŸ“"};class xi{constructor(){zt(this,"config",{enabled:!1,minLevel:"debug",enabledCategories:"all",persistLogs:!0,maxStoredLogs:500});zt(this,"logs",[]);zt(this,"storageKey","leadscout:logs");this.loadStoredLogs()}get api(){return this.createCategoryLogger("api")}get selector(){return this.createCategoryLogger("selector")}get storage(){return this.createCategoryLogger("storage")}get ai(){return this.createCategoryLogger("ai")}get scan(){return this.createCategoryLogger("scan")}get auth(){return this.createCategoryLogger("auth")}get extension(){return this.createCategoryLogger("extension")}get ui(){return this.createCategoryLogger("ui")}get general(){return this.createCategoryLogger("general")}createCategoryLogger(e){return{debug:(t,n)=>this.log("debug",e,t,n),info:(t,n)=>this.log("info",e,t,n),warn:(t,n)=>this.log("warn",e,t,n),error:(t,n)=>this.log("error",e,t,n)}}log(e,t,n,r){if(!this.shouldLog(e,t))return;const a={timestamp:new Date().toISOString(),level:e,category:t,message:n,data:this.sanitizeData(r),stack:e==="error"?new Error().stack:void 0};this.printToConsole(a),this.storeLog(a)}shouldLog(e,t){return!(!this.config.enabled||Bs[e]<Bs[this.config.minLevel]||this.config.enabledCategories!=="all"&&!this.config.enabledCategories.includes(t))}sanitizeData(e){if(e!==void 0)try{return JSON.parse(JSON.stringify(e,(t,n)=>typeof n=="string"&&n.length>1e3?n.substring(0,1e3)+"... [truncated]":n instanceof HTMLElement?`[HTMLElement: ${n.tagName}${n.id?"#"+n.id:""}${n.className?"."+n.className.split(" ")[0]:""}]`:typeof n=="function"?"[Function]":n))}catch{return"[Unserializable data]"}}printToConsole(e){const t=Us[e.category],n=bi[e.category],r=e.timestamp.split("T")[1].split(".")[0],a=`%c${t} [${r}] [${e.category.toUpperCase()}]`,i=`color: ${n}; font-weight: bold;`,o=e.level==="error"?console.error:e.level==="warn"?console.warn:e.level==="debug"?console.debug:console.log;e.data!==void 0?o(a,i,e.message,e.data):o(a,i,e.message),e.stack&&e.level==="error"&&console.debug("%cStack trace:","color: #666; font-size: 10px;",e.stack)}storeLog(e){if(this.config.persistLogs){this.logs.push(e),this.logs.length>this.config.maxStoredLogs&&(this.logs=this.logs.slice(-this.config.maxStoredLogs));try{localStorage.setItem(this.storageKey,JSON.stringify(this.logs))}catch{this.logs=this.logs.slice(-100)}}}loadStoredLogs(){try{const e=localStorage.getItem(this.storageKey);e&&(this.logs=JSON.parse(e))}catch{this.logs=[]}}getLogs(){return[...this.logs]}getLogsByCategory(e){return this.logs.filter(t=>t.category===e)}getLogsByLevel(e){return this.logs.filter(t=>t.level===e)}getRecentLogs(e=50){return this.logs.slice(-e)}getErrors(){return this.logs.filter(e=>e.level==="error")}searchLogs(e){const t=e.toLowerCase();return this.logs.filter(n=>n.message.toLowerCase().includes(t)||JSON.stringify(n.data).toLowerCase().includes(t))}clearLogs(){this.logs=[];try{localStorage.removeItem(this.storageKey)}catch{}this.general.info("Logs cleared")}exportLogs(){return JSON.stringify(this.logs,null,2)}downloadLogs(){const e=this.exportLogs(),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=`leadscout-logs-${new Date().toISOString().split("T")[0]}.json`,r.click(),URL.revokeObjectURL(n)}printSummary(){const e={total:this.logs.length,byLevel:{debug:this.logs.filter(t=>t.level==="debug").length,info:this.logs.filter(t=>t.level==="info").length,warn:this.logs.filter(t=>t.level==="warn").length,error:this.logs.filter(t=>t.level==="error").length},byCategory:{}};for(const t of Object.keys(Us))e.byCategory[t]=this.logs.filter(n=>n.category===t).length;console.log("%cðŸ“Š LeadScout Log Summary","font-size: 14px; font-weight: bold; color: #3b82f6;"),console.table(e.byLevel),console.table(e.byCategory)}configure(e){this.config={...this.config,...e},this.general.info("Logger configured",e)}setEnabled(e){this.config.enabled=e}setMinLevel(e){this.config.minLevel=e}setCategories(e){this.config.enabledCategories=e}logApiRequest(e,t,n){this.api.info(`[${e.toUpperCase()}] Request: ${t}`,{provider:e,endpoint:t,payload:this.truncatePayload(n)})}logApiResponse(e,t,n,r){this.api.info(`[${e.toUpperCase()}] Response: ${t} (${r}ms)`,{provider:e,endpoint:t,durationMs:r,response:this.truncatePayload(n)})}logApiError(e,t,n){this.api.error(`[${e.toUpperCase()}] Error: ${t}`,{provider:e,endpoint:t,error:n instanceof Error?{message:n.message,stack:n.stack}:n})}logSelector(e,t,n){const r=e==="not_found"?"warn":"debug";this.selector[r](`Selector ${e}: ${t}`,{selector:t,count:n})}logScan(e,t){const n=e==="error"?"error":"info";this.scan[n](`Scan ${e}`,t)}logAiAnalysis(e,t,n,r){this.ai.info(`AI ${e}`,{input:this.truncatePayload(t),output:n,durationMs:r})}truncatePayload(e){const t=JSON.stringify(e);return t&&t.length>500?JSON.parse(t.substring(0,500)+'..."'):e}}const Y=new xi;typeof window<"u"&&(window.__leadscout_logger=Y);let en=null;function vi(s){Y.api.info("Gemini SDK initialized"),en=new fi(s)}const Ci=`You are a helpful assistant that generates authentic, non-salesy replies for social media posts.

Guidelines:
1. Be genuinely helpful, not promotional
2. Acknowledge their specific situation
3. Offer value without being pushy
4. Sound like a real person, not a bot
5. Keep it concise (2-4 sentences max)
6. Don't use emojis unless the original post does
7. Never use phrases like "I'd be happy to help" or "Feel free to reach out"

Respond ONLY with the reply text, nothing else.`;async function Ei(s,e,t){if(!en)throw Y.api.error("Gemini not initialized"),new Error("Gemini not initialized. Call initGemini() first.");const n=en.getGenerativeModel({model:"gemini-1.5-flash"}),r=Date.now(),a={professional:"formal but approachable",casual:"friendly and conversational",friendly:"warm and personable",expert:"knowledgeable but not condescending"},i=`${Ci}

Your persona:
- Role: ${t.role}
- Tone: ${a[t.aiTone]}
- Value proposition: ${t.valueProposition}
${t.signature?`- Signature style: ${t.signature}`:""}

The post intent is: ${e}

Original post:
"${s.slice(0,1e3)}"

Generate a helpful reply:`;Y.logApiRequest("gemini","generateContent/generateReply",{model:"gemini-1.5-flash",intent:e,promptLength:i.length});const d=(await n.generateContent(i)).response.text().trim();return Y.logApiResponse("gemini","generateContent/generateReply",{replyLength:d.length},Date.now()-r),d}const tn="RFC3986",nn={RFC1738:s=>String(s).replace(/%20/g,"+"),RFC3986:s=>String(s)},Si="RFC1738",Ri=Array.isArray,oe=(()=>{const s=[];for(let e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})(),sn=1024,Ii=(s,e,t,n,r)=>{if(s.length===0)return s;let a=s;if(typeof s=="symbol"?a=Symbol.prototype.toString.call(s):typeof s!="string"&&(a=String(s)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let i="";for(let o=0;o<a.length;o+=sn){const d=a.length>=sn?a.slice(o,o+sn):a,h=[];for(let b=0;b<d.length;++b){let g=d.charCodeAt(b);if(g===45||g===46||g===95||g===126||g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122||r===Si&&(g===40||g===41)){h[h.length]=d.charAt(b);continue}if(g<128){h[h.length]=oe[g];continue}if(g<2048){h[h.length]=oe[192|g>>6]+oe[128|g&63];continue}if(g<55296||g>=57344){h[h.length]=oe[224|g>>12]+oe[128|g>>6&63]+oe[128|g&63];continue}b+=1,g=65536+((g&1023)<<10|d.charCodeAt(b)&1023),h[h.length]=oe[240|g>>18]+oe[128|g>>12&63]+oe[128|g>>6&63]+oe[128|g&63]}i+=h.join("")}return i};function Oi(s){return!s||typeof s!="object"?!1:!!(s.constructor&&s.constructor.isBuffer&&s.constructor.isBuffer(s))}function js(s,e){if(Ri(s)){const t=[];for(let n=0;n<s.length;n+=1)t.push(e(s[n]));return t}return e(s)}const Pi=Object.prototype.hasOwnProperty,Vs={brackets(s){return String(s)+"[]"},comma:"comma",indices(s,e){return String(s)+"["+e+"]"},repeat(s){return String(s)}},ce=Array.isArray,Ti=Array.prototype.push,Gs=function(s,e){Ti.apply(s,ce(e)?e:[e])},$i=Date.prototype.toISOString,B={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Ii,encodeValuesOnly:!1,format:tn,formatter:nn[tn],indices:!1,serializeDate(s){return $i.call(s)},skipNulls:!1,strictNullHandling:!1};function Mi(s){return typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s=="symbol"||typeof s=="bigint"}const rn={};function Hs(s,e,t,n,r,a,i,o,d,h,b,g,A,w,x,l,c,f){let u=s,_=f,y=0,I=!1;for(;(_=_.get(rn))!==void 0&&!I;){const S=_.get(s);if(y+=1,typeof S<"u"){if(S===y)throw new RangeError("Cyclic object value");I=!0}typeof _.get(rn)>"u"&&(y=0)}if(typeof h=="function"?u=h(e,u):u instanceof Date?u=A==null?void 0:A(u):t==="comma"&&ce(u)&&(u=js(u,function(S){return S instanceof Date?A==null?void 0:A(S):S})),u===null){if(a)return d&&!l?d(e,B.encoder,c,"key",w):e;u=""}if(Mi(u)||Oi(u)){if(d){const S=l?e:d(e,B.encoder,c,"key",w);return[(x==null?void 0:x(S))+"="+(x==null?void 0:x(d(u,B.encoder,c,"value",w)))]}return[(x==null?void 0:x(e))+"="+(x==null?void 0:x(String(u)))]}const m=[];if(typeof u>"u")return m;let p;if(t==="comma"&&ce(u))l&&d&&(u=js(u,d)),p=[{value:u.length>0?u.join(",")||null:void 0}];else if(ce(h))p=h;else{const S=Object.keys(u);p=b?S.sort(b):S}const v=o?String(e).replace(/\./g,"%2E"):String(e),C=n&&ce(u)&&u.length===1?v+"[]":v;if(r&&ce(u)&&u.length===0)return C+"[]";for(let S=0;S<p.length;++S){const $=p[S],M=typeof $=="object"&&typeof $.value<"u"?$.value:u[$];if(i&&M===null)continue;const P=g&&o?$.replace(/\./g,"%2E"):$,D=ce(u)?typeof t=="function"?t(C,P):C:C+(g?"."+P:"["+P+"]");f.set(s,y);const N=new WeakMap;N.set(rn,f),Gs(m,Hs(M,D,t,n,r,a,i,o,t==="comma"&&l&&ce(u)?null:d,h,b,g,A,w,x,l,c,N))}return m}function ki(s=B){if(typeof s.allowEmptyArrays<"u"&&typeof s.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof s.encodeDotInKeys<"u"&&typeof s.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(s.encoder!==null&&typeof s.encoder<"u"&&typeof s.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=s.charset||B.charset;if(typeof s.charset<"u"&&s.charset!=="utf-8"&&s.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=tn;if(typeof s.format<"u"){if(!Pi.call(nn,s.format))throw new TypeError("Unknown format option provided.");t=s.format}const n=nn[t];let r=B.filter;(typeof s.filter=="function"||ce(s.filter))&&(r=s.filter);let a;if(s.arrayFormat&&s.arrayFormat in Vs?a=s.arrayFormat:"indices"in s?a=s.indices?"indices":"repeat":a=B.arrayFormat,"commaRoundTrip"in s&&typeof s.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=typeof s.allowDots>"u"?s.encodeDotInKeys?!0:B.allowDots:!!s.allowDots;return{addQueryPrefix:typeof s.addQueryPrefix=="boolean"?s.addQueryPrefix:B.addQueryPrefix,allowDots:i,allowEmptyArrays:typeof s.allowEmptyArrays=="boolean"?!!s.allowEmptyArrays:B.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof s.charsetSentinel=="boolean"?s.charsetSentinel:B.charsetSentinel,commaRoundTrip:!!s.commaRoundTrip,delimiter:typeof s.delimiter>"u"?B.delimiter:s.delimiter,encode:typeof s.encode=="boolean"?s.encode:B.encode,encodeDotInKeys:typeof s.encodeDotInKeys=="boolean"?s.encodeDotInKeys:B.encodeDotInKeys,encoder:typeof s.encoder=="function"?s.encoder:B.encoder,encodeValuesOnly:typeof s.encodeValuesOnly=="boolean"?s.encodeValuesOnly:B.encodeValuesOnly,filter:r,format:t,formatter:n,serializeDate:typeof s.serializeDate=="function"?s.serializeDate:B.serializeDate,skipNulls:typeof s.skipNulls=="boolean"?s.skipNulls:B.skipNulls,sort:typeof s.sort=="function"?s.sort:null,strictNullHandling:typeof s.strictNullHandling=="boolean"?s.strictNullHandling:B.strictNullHandling}}function Ni(s,e={}){let t=s;const n=ki(e);let r,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):ce(n.filter)&&(a=n.filter,r=a);const i=[];if(typeof t!="object"||t===null)return"";const o=Vs[n.arrayFormat],d=o==="comma"&&n.commaRoundTrip;r||(r=Object.keys(t)),n.sort&&r.sort(n.sort);const h=new WeakMap;for(let A=0;A<r.length;++A){const w=r[A];n.skipNulls&&t[w]===null||Gs(i,Hs(t[w],w,o,d,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,h))}const b=i.join(n.delimiter);let g=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?g+="utf8=%26%2310003%3B&":g+="utf8=%E2%9C%93&"),b.length>0?g+b:""}const Me="4.104.0";let qs=!1,Ye,Ks,Ws,an,Js,Xs,Ys,zs,Qs;function Li(s,e={auto:!1}){if(qs)throw new Error(`you must \`import 'openai/shims/${s.kind}'\` before importing anything else from openai`);if(Ye)throw new Error(`can't \`import 'openai/shims/${s.kind}'\` after \`import 'openai/shims/${Ye}'\``);qs=e.auto,Ye=s.kind,Ks=s.fetch,Ws=s.FormData,an=s.File,Js=s.ReadableStream,Xs=s.getMultipartRequestOptions,Ys=s.getDefaultAgent,zs=s.fileFromPath,Qs=s.isFsReadStream}class Fi{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function Di({manuallyImported:s}={}){const e=s?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,r,a;try{t=fetch,n=Request,r=Response,a=Headers}catch(i){throw new Error(`this environment is missing the following Web Fetch API type: ${i.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:r,Headers:a,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(i,o)=>({...o,body:new Fi(i)}),getDefaultAgent:i=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:i=>!1}}const Zs=()=>{Ye||Li(Di(),{auto:!0})};Zs();class R extends Error{}class H extends R{constructor(e,t,n,r){super(`${H.makeMessage(e,t,n)}`),this.status=e,this.headers=r,this.request_id=r==null?void 0:r["x-request-id"],this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,n){const r=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,n,r){if(!e||!r)return new wt({message:n,cause:dn(t)});const a=t==null?void 0:t.error;return e===400?new er(e,a,n,r):e===401?new tr(e,a,n,r):e===403?new nr(e,a,n,r):e===404?new sr(e,a,n,r):e===409?new rr(e,a,n,r):e===422?new ar(e,a,n,r):e===429?new ir(e,a,n,r):e>=500?new or(e,a,n,r):new H(e,a,n,r)}}class te extends H{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class wt extends H{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class on extends wt{constructor({message:e}={}){super({message:e??"Request timed out."})}}class er extends H{}class tr extends H{}class nr extends H{}class sr extends H{}class rr extends H{}class ar extends H{}class ir extends H{}class or extends H{}class cr extends R{constructor(){super("Could not parse response content as the length limit was reached")}}class lr extends R{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var _t=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Re=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},z;class yt{constructor(){z.set(this,void 0),this.buffer=new Uint8Array,_t(this,z,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let n=new Uint8Array(this.buffer.length+t.length);n.set(this.buffer),n.set(t,this.buffer.length),this.buffer=n;const r=[];let a;for(;(a=Bi(this.buffer,Re(this,z,"f")))!=null;){if(a.carriage&&Re(this,z,"f")==null){_t(this,z,a.index,"f");continue}if(Re(this,z,"f")!=null&&(a.index!==Re(this,z,"f")+1||a.carriage)){r.push(this.decodeText(this.buffer.slice(0,Re(this,z,"f")-1))),this.buffer=this.buffer.slice(Re(this,z,"f")),_t(this,z,null,"f");continue}const i=Re(this,z,"f")!==null?a.preceding-1:a.preceding,o=this.decodeText(this.buffer.slice(0,i));r.push(o),this.buffer=this.buffer.slice(a.index),_t(this,z,null,"f")}return r}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new R(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new R(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new R("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}z=new WeakMap,yt.NEWLINE_CHARS=new Set([`
`,"\r"]),yt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Bi(s,e){for(let r=e??0;r<s.length;r++){if(s[r]===10)return{preceding:r,index:r+1,carriage:!1};if(s[r]===13)return{preceding:r,index:r+1,carriage:!0}}return null}function Ui(s){for(let n=0;n<s.length-1;n++){if(s[n]===10&&s[n+1]===10||s[n]===13&&s[n+1]===13)return n+2;if(s[n]===13&&s[n+1]===10&&n+3<s.length&&s[n+2]===13&&s[n+3]===10)return n+4}return-1}function ur(s){if(s[Symbol.asyncIterator])return s;const e=s.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class le{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*r(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(const i of ji(e,t))if(!a){if(i.data.startsWith("[DONE]")){a=!0;continue}if(i.event===null||i.event.startsWith("response.")||i.event.startsWith("transcript.")){let o;try{o=JSON.parse(i.data)}catch(d){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),d}if(o&&o.error)throw new H(void 0,o.error,void 0,_r(e.headers));yield o}else{let o;try{o=JSON.parse(i.data)}catch(d){throw console.error("Could not parse message into JSON:",i.data),console.error("From chunk:",i.raw),d}if(i.event=="error")throw new H(void 0,o.error,o.message,void 0);yield{event:i.event,data:o}}}a=!0}catch(i){if(i instanceof Error&&i.name==="AbortError")return;throw i}finally{a||t.abort()}}return new le(r,t)}static fromReadableStream(e,t){let n=!1;async function*r(){const i=new yt,o=ur(e);for await(const d of o)for(const h of i.decode(d))yield h;for(const d of i.flush())yield d}async function*a(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let i=!1;try{for await(const o of r())i||o&&(yield JSON.parse(o));i=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{i||t.abort()}}return new le(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),r=a=>({next:()=>{if(a.length===0){const i=n.next();e.push(i),t.push(i)}return a.shift()}});return[new le(()=>r(e),this.controller),new le(()=>r(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Js({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:a,done:i}=await t.next();if(i)return r.close();const o=n.encode(JSON.stringify(a)+`
`);r.enqueue(o)}catch(a){r.error(a)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}}async function*ji(s,e){if(!s.body)throw e.abort(),new R("Attempted to iterate over a response with no body");const t=new Gi,n=new yt,r=ur(s.body);for await(const a of Vi(r))for(const i of n.decode(a)){const o=t.decode(i);o&&(yield o)}for(const a of n.flush()){const i=t.decode(a);i&&(yield i)}}async function*Vi(s){let e=new Uint8Array;for await(const t of s){if(t==null)continue;const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),e=r;let a;for(;(a=Ui(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class Gi{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,r]=Hi(e,":");return r.startsWith(" ")&&(r=r.substring(1)),t==="event"?this.event=r:t==="data"&&this.data.push(r),null}}function Hi(s,e){const t=s.indexOf(e);return t!==-1?[s.substring(0,t),e,s.substring(t+e.length)]:[s,"",""]}const dr=s=>s!=null&&typeof s=="object"&&typeof s.url=="string"&&typeof s.blob=="function",fr=s=>s!=null&&typeof s=="object"&&typeof s.name=="string"&&typeof s.lastModified=="number"&&At(s),At=s=>s!=null&&typeof s=="object"&&typeof s.size=="number"&&typeof s.type=="string"&&typeof s.text=="function"&&typeof s.slice=="function"&&typeof s.arrayBuffer=="function",qi=s=>fr(s)||dr(s)||Qs(s);async function hr(s,e,t){var r;if(s=await s,fr(s))return s;if(dr(s)){const a=await s.blob();e||(e=new URL(s.url).pathname.split(/[\\/]/).pop()??"unknown_file");const i=At(a)?[await a.arrayBuffer()]:[a];return new an(i,e,t)}const n=await Ki(s);if(e||(e=Ji(s)??"unknown_file"),!(t!=null&&t.type)){const a=(r=n[0])==null?void 0:r.type;typeof a=="string"&&(t={...t,type:a})}return new an(n,e,t)}async function Ki(s){var t;let e=[];if(typeof s=="string"||ArrayBuffer.isView(s)||s instanceof ArrayBuffer)e.push(s);else if(At(s))e.push(await s.arrayBuffer());else if(Xi(s))for await(const n of s)e.push(n);else throw new Error(`Unexpected data type: ${typeof s}; constructor: ${(t=s==null?void 0:s.constructor)==null?void 0:t.name}; props: ${Wi(s)}`);return e}function Wi(s){return`[${Object.getOwnPropertyNames(s).map(t=>`"${t}"`).join(", ")}]`}function Ji(s){var e;return cn(s.name)||cn(s.filename)||((e=cn(s.path))==null?void 0:e.split(/[\\/]/).pop())}const cn=s=>{if(typeof s=="string")return s;if(typeof Buffer<"u"&&s instanceof Buffer)return String(s)},Xi=s=>s!=null&&typeof s=="object"&&typeof s[Symbol.asyncIterator]=="function",gr=s=>s&&typeof s=="object"&&s.body&&s[Symbol.toStringTag]==="MultipartBody",Ie=async s=>{const e=await Yi(s.body);return Xs(e,s)},Yi=async s=>{const e=new Ws;return await Promise.all(Object.entries(s||{}).map(([t,n])=>ln(e,t,n))),e},ln=async(s,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")s.append(e,String(t));else if(qi(t)){const n=await hr(t);s.append(e,n)}else if(Array.isArray(t))await Promise.all(t.map(n=>ln(s,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,r])=>ln(s,`${e}[${n}]`,r)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var zi=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Qi=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},bt;Zs();async function mr(s){var i;const{response:e}=s;if(s.options.stream)return we("response",e.status,e.url,e.headers,e.body),s.options.__streamClass?s.options.__streamClass.fromSSEResponse(e,s.controller):le.fromSSEResponse(e,s.controller);if(e.status===204)return null;if(s.options.__binaryResponse)return e;const t=e.headers.get("content-type"),n=(i=t==null?void 0:t.split(";")[0])==null?void 0:i.trim();if((n==null?void 0:n.includes("application/json"))||(n==null?void 0:n.endsWith("+json"))){const o=await e.json();return we("response",e.status,e.url,e.headers,o),pr(o,e)}const a=await e.text();return we("response",e.status,e.url,e.headers,a),a}function pr(s,e){return!s||typeof s!="object"||Array.isArray(s)?s:Object.defineProperty(s,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}class xt extends Promise{constructor(e,t=mr){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new xt(this.responsePromise,async t=>pr(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Zi{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:r,fetch:a}){this.baseURL=e,this.maxRetries=un("maxRetries",t),this.timeout=un("timeout",n),this.httpAgent=r,this.fetch=a??Ks}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ro(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${co()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(async r=>{const a=r&&At(r==null?void 0:r.body)?new DataView(await r.body.arrayBuffer()):(r==null?void 0:r.body)instanceof DataView?r.body:(r==null?void 0:r.body)instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r==null?void 0:r.body)?new DataView(r.body.buffer):r==null?void 0:r.body;return{method:e,path:t,...r,body:a}}))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){var l;const n={...e},{method:r,path:a,query:i,headers:o={}}=n,d=ArrayBuffer.isView(n.body)||n.__binaryRequest&&typeof n.body=="string"?n.body:gr(n.body)?n.body.body:n.body?JSON.stringify(n.body,null,2):null,h=this.calculateContentLength(d),b=this.buildURL(a,i);"timeout"in n&&un("timeout",n.timeout),n.timeout=n.timeout??this.timeout;const g=n.httpAgent??this.httpAgent??Ys(b),A=n.timeout+1e3;typeof((l=g==null?void 0:g.options)==null?void 0:l.timeout)=="number"&&A>(g.options.timeout??0)&&(g.options.timeout=A),this.idempotencyHeader&&r!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const w=this.buildHeaders({options:n,headers:o,contentLength:h,retryCount:t});return{req:{method:r,...d&&{body:d},headers:w,...g&&{agent:g},signal:n.signal??null},url:b,timeout:n.timeout}}buildHeaders({options:e,headers:t,contentLength:n,retryCount:r}){const a={};n&&(a["content-length"]=n);const i=this.defaultHeaders(e);return Cr(a,i),Cr(a,t),gr(e.body)&&Ye!=="node"&&delete a["content-type"],Ct(i,"x-stainless-retry-count")===void 0&&Ct(t,"x-stainless-retry-count")===void 0&&(a["x-stainless-retry-count"]=String(r)),Ct(i,"x-stainless-timeout")===void 0&&Ct(t,"x-stainless-timeout")===void 0&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,r){return H.generate(e,t,n,r)}request(e,t=null){return new xt(this.makeRequest(e,t))}async makeRequest(e,t){var g,A;const n=await e,r=n.maxRetries??this.maxRetries;t==null&&(t=r),await this.prepareOptions(n);const{req:a,url:i,timeout:o}=this.buildRequest(n,{retryCount:r-t});if(await this.prepareRequest(a,{url:i,options:n}),we("request",i,n,a.headers),(g=n.signal)!=null&&g.aborted)throw new te;const d=new AbortController,h=await this.fetchWithTimeout(i,a,o,d).catch(dn);if(h instanceof Error){if((A=n.signal)!=null&&A.aborted)throw new te;if(t)return this.retryRequest(n,t);throw h.name==="AbortError"?new on:new wt({cause:h})}const b=_r(h.headers);if(!h.ok){if(t&&this.shouldRetry(h)){const u=`retrying, ${t} attempts remaining`;return we(`response (error; ${u})`,h.status,i,b),this.retryRequest(n,t,b)}const w=await h.text().catch(u=>dn(u).message),x=ao(w),l=x?void 0:w;throw we(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,h.status,i,b,l),this.makeStatusError(h.status,x,l,b)}return{response:h,options:n,controller:d}}requestAPIList(e,t){const n=this.makeRequest(t,null);return new eo(this,n,e)}buildURL(e,t){const n=oo(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),r=this.defaultQuery();return xr(r)||(t={...r,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new R(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,n,r){const{signal:a,...i}=t||{};a&&a.addEventListener("abort",()=>r.abort());const o=setTimeout(()=>r.abort(),n),d={signal:r.signal,...i};return d.method&&(d.method=d.method.toUpperCase()),this.fetch.call(void 0,e,d).finally(()=>{clearTimeout(o)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n){let r;const a=n==null?void 0:n["retry-after-ms"];if(a){const o=parseFloat(a);Number.isNaN(o)||(r=o)}const i=n==null?void 0:n["retry-after"];if(i&&!r){const o=parseFloat(i);Number.isNaN(o)?r=Date.parse(i)-Date.now():r=o*1e3}if(!(r&&0<=r&&r<6e4)){const o=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,o)}return await ze(r),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,i=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return i*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Me}`}}class wr{constructor(e,t,n,r){bt.set(this,void 0),zi(this,bt,e,"f"),this.options=r,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new R("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const n=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[r,a]of n)e.url.searchParams.set(r,a);t.query=void 0,t.path=e.url.toString()}return await Qi(this,bt,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(bt=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class eo extends xt{constructor(e,t,n){super(t,async r=>new n(e,r.response,await mr(r),r.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const _r=s=>new Proxy(Object.fromEntries(s.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),to={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},L=s=>typeof s=="object"&&s!==null&&!xr(s)&&Object.keys(s).every(e=>vr(to,e)),no=()=>{var e;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":Ar(Deno.build.os),"X-Stainless-Arch":yr(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((e=Deno.version)==null?void 0:e.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":Ar(process.platform),"X-Stainless-Arch":yr(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const s=so();return s?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${s.browser}`,"X-Stainless-Runtime-Version":s.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Me,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function so(){if(typeof navigator>"u"||!navigator)return null;const s=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of s){const n=t.exec(navigator.userAgent);if(n){const r=n[1]||0,a=n[2]||0,i=n[3]||0;return{browser:e,version:`${r}.${a}.${i}`}}}return null}const yr=s=>s==="x32"?"x32":s==="x86_64"||s==="x64"?"x64":s==="arm"?"arm":s==="aarch64"||s==="arm64"?"arm64":s?`other:${s}`:"unknown",Ar=s=>(s=s.toLowerCase(),s.includes("ios")?"iOS":s==="android"?"Android":s==="darwin"?"MacOS":s==="win32"?"Windows":s==="freebsd"?"FreeBSD":s==="openbsd"?"OpenBSD":s==="linux"?"Linux":s?`Other:${s}`:"Unknown");let br;const ro=()=>br??(br=no()),ao=s=>{try{return JSON.parse(s)}catch{return}},io=/^[a-z][a-z0-9+.-]*:/i,oo=s=>io.test(s),ze=s=>new Promise(e=>setTimeout(e,s)),un=(s,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new R(`${s} must be an integer`);if(e<0)throw new R(`${s} must be a positive integer`);return e},dn=s=>{if(s instanceof Error)return s;if(typeof s=="object"&&s!==null)try{return new Error(JSON.stringify(s))}catch{}return new Error(s)},vt=s=>{var e,t,n,r,a;if(typeof process<"u")return((t=(e=process.env)==null?void 0:e[s])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(a=(r=(n=Deno.env)==null?void 0:n.get)==null?void 0:r.call(n,s))==null?void 0:a.trim()};function xr(s){if(!s)return!0;for(const e in s)return!1;return!0}function vr(s,e){return Object.prototype.hasOwnProperty.call(s,e)}function Cr(s,e){for(const t in e){if(!vr(e,t))continue;const n=t.toLowerCase();if(!n)continue;const r=e[t];r===null?delete s[n]:r!==void 0&&(s[n]=r)}}const Er=new Set(["authorization","api-key"]);function we(s,...e){var t;if(typeof process<"u"&&((t=process==null?void 0:process.env)==null?void 0:t.DEBUG)==="true"){const n=e.map(r=>{if(!r)return r;if(r.headers){const i={...r,headers:{...r.headers}};for(const o in r.headers)Er.has(o.toLowerCase())&&(i.headers[o]="REDACTED");return i}let a=null;for(const i in r)Er.has(i.toLowerCase())&&(a??(a={...r}),a[i]="REDACTED");return a??r});console.log(`OpenAI:DEBUG:${s}`,...n)}}const co=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)}),lo=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",uo=s=>typeof(s==null?void 0:s.get)=="function",Ct=(s,e)=>{var n;const t=e.toLowerCase();if(uo(s)){const r=((n=e[0])==null?void 0:n.toUpperCase())+e.substring(1).replace(/([^\w])(\w)/g,(a,i,o)=>i+o.toUpperCase());for(const a of[e,t,e.toUpperCase(),r]){const i=s.get(a);if(i)return i}}for(const[r,a]of Object.entries(s))if(r.toLowerCase()===t)return Array.isArray(a)?(a.length<=1||console.warn(`Received ${a.length} entries for the ${e} header, using the first entry.`),a[0]):a},fo=s=>{if(typeof Buffer<"u"){const e=Buffer.from(s,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(s),t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return Array.from(new Float32Array(n.buffer))}};function fn(s){return s!=null&&typeof s=="object"&&!Array.isArray(s)}class Et extends wr{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class U extends wr{constructor(e,t,n,r){super(e,t,n,r),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){var n;const e=this.getPaginatedItems();if(!e.length)return null;const t=(n=e[e.length-1])==null?void 0:n.id;return t?{params:{after:t}}:null}}class O{constructor(e){this._client=e}}let Sr=class extends O{list(e,t={},n){return L(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,ho,{query:t,...n})}},St=class extends O{constructor(){super(...arguments),this.messages=new Sr(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return L(e)?this.list({},e):this._client.getAPIList("/chat/completions",Rt,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class Rt extends U{}class ho extends U{}St.ChatCompletionsPage=Rt,St.Messages=Sr;let It=class extends O{constructor(){super(...arguments),this.completions=new St(this._client)}};It.Completions=St,It.ChatCompletionsPage=Rt;class Rr extends O{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t==null?void 0:t.headers},__binaryResponse:!0})}}class Ir extends O{create(e,t){return this._client.post("/audio/transcriptions",Ie({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class Or extends O{create(e,t){return this._client.post("/audio/translations",Ie({body:e,...t,__metadata:{model:e.model}}))}}class Qe extends O{constructor(){super(...arguments),this.transcriptions=new Ir(this._client),this.translations=new Or(this._client),this.speech=new Rr(this._client)}}Qe.Transcriptions=Ir,Qe.Translations=Or,Qe.Speech=Rr;class hn extends O{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return L(e)?this.list({},e):this._client.getAPIList("/batches",gn,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class gn extends U{}hn.BatchesPage=gn;var re=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},F=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},mn,Ot,Pt,Ze,et,Tt,tt,he,nt,$t,Mt,ke,Pr;class pn{constructor(){mn.add(this),this.controller=new AbortController,Ot.set(this,void 0),Pt.set(this,()=>{}),Ze.set(this,()=>{}),et.set(this,void 0),Tt.set(this,()=>{}),tt.set(this,()=>{}),he.set(this,{}),nt.set(this,!1),$t.set(this,!1),Mt.set(this,!1),ke.set(this,!1),re(this,Ot,new Promise((e,t)=>{re(this,Pt,e,"f"),re(this,Ze,t,"f")}),"f"),re(this,et,new Promise((e,t)=>{re(this,Tt,e,"f"),re(this,tt,t,"f")}),"f"),F(this,Ot,"f").catch(()=>{}),F(this,et,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},F(this,mn,"m",Pr).bind(this))},0)}_connected(){this.ended||(F(this,Pt,"f").call(this),this._emit("connect"))}get ended(){return F(this,nt,"f")}get errored(){return F(this,$t,"f")}get aborted(){return F(this,Mt,"f")}abort(){this.controller.abort()}on(e,t){return(F(this,he,"f")[e]||(F(this,he,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=F(this,he,"f")[e];if(!n)return this;const r=n.findIndex(a=>a.listener===t);return r>=0&&n.splice(r,1),this}once(e,t){return(F(this,he,"f")[e]||(F(this,he,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{re(this,ke,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){re(this,ke,!0,"f"),await F(this,et,"f")}_emit(e,...t){if(F(this,nt,"f"))return;e==="end"&&(re(this,nt,!0,"f"),F(this,Tt,"f").call(this));const n=F(this,he,"f")[e];if(n&&(F(this,he,"f")[e]=n.filter(r=>!r.once),n.forEach(({listener:r})=>r(...t))),e==="abort"){const r=t[0];!F(this,ke,"f")&&!(n!=null&&n.length)&&Promise.reject(r),F(this,Ze,"f").call(this,r),F(this,tt,"f").call(this,r),this._emit("end");return}if(e==="error"){const r=t[0];!F(this,ke,"f")&&!(n!=null&&n.length)&&Promise.reject(r),F(this,Ze,"f").call(this,r),F(this,tt,"f").call(this,r),this._emit("end")}}_emitFinal(){}}Ot=new WeakMap,Pt=new WeakMap,Ze=new WeakMap,et=new WeakMap,Tt=new WeakMap,tt=new WeakMap,he=new WeakMap,nt=new WeakMap,$t=new WeakMap,Mt=new WeakMap,ke=new WeakMap,mn=new WeakSet,Pr=function(e){if(re(this,$t,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new te),e instanceof te)return re(this,Mt,!0,"f"),this._emit("abort",e);if(e instanceof R)return this._emit("error",e);if(e instanceof Error){const t=new R(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new R(String(e)))};var E=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},Q=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},q,wn,ue,kt,ae,Oe,Ne,Pe,Nt,Z,Lt,Ft,st,rt,at,Tr,$r,Mr,kr,Nr,Lr,Fr;class ie extends pn{constructor(){super(...arguments),q.add(this),wn.set(this,[]),ue.set(this,{}),kt.set(this,{}),ae.set(this,void 0),Oe.set(this,void 0),Ne.set(this,void 0),Pe.set(this,void 0),Nt.set(this,void 0),Z.set(this,void 0),Lt.set(this,void 0),Ft.set(this,void 0),st.set(this,void 0)}[(wn=new WeakMap,ue=new WeakMap,kt=new WeakMap,ae=new WeakMap,Oe=new WeakMap,Ne=new WeakMap,Pe=new WeakMap,Nt=new WeakMap,Z=new WeakMap,Lt=new WeakMap,Ft=new WeakMap,st=new WeakMap,q=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new ie;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();const r=le.fromReadableStream(e,this.controller);for await(const i of r)E(this,q,"m",rt).call(this,i);if((a=r.controller.signal)!=null&&a.aborted)throw new te;return this._addRun(E(this,q,"m",at).call(this))}toReadableStream(){return new le(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,r,a){const i=new ie;return i._run(()=>i._runToolAssistantStream(e,t,n,r,{...a,headers:{...a==null?void 0:a.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,n,r,a){var h;const i=a==null?void 0:a.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const o={...r,stream:!0},d=await e.submitToolOutputs(t,n,o,{...a,signal:this.controller.signal});this._connected();for await(const b of d)E(this,q,"m",rt).call(this,b);if((h=d.controller.signal)!=null&&h.aborted)throw new te;return this._addRun(E(this,q,"m",at).call(this))}static createThreadAssistantStream(e,t,n){const r=new ie;return r._run(()=>r._threadAssistantStream(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}static createAssistantStream(e,t,n,r){const a=new ie;return a._run(()=>a._runAssistantStream(e,t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return E(this,Lt,"f")}currentRun(){return E(this,Ft,"f")}currentMessageSnapshot(){return E(this,ae,"f")}currentRunStepSnapshot(){return E(this,st,"f")}async finalRunSteps(){return await this.done(),Object.values(E(this,ue,"f"))}async finalMessages(){return await this.done(),Object.values(E(this,kt,"f"))}async finalRun(){if(await this.done(),!E(this,Oe,"f"))throw Error("Final run was not received.");return E(this,Oe,"f")}async _createThreadAssistantStream(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},i=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(const d of i)E(this,q,"m",rt).call(this,d);if((o=i.controller.signal)!=null&&o.aborted)throw new te;return this._addRun(E(this,q,"m",at).call(this))}async _createAssistantStream(e,t,n,r){var d;const a=r==null?void 0:r.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const i={...n,stream:!0},o=await e.create(t,i,{...r,signal:this.controller.signal});this._connected();for await(const h of o)E(this,q,"m",rt).call(this,h);if((d=o.controller.signal)!=null&&d.aborted)throw new te;return this._addRun(E(this,q,"m",at).call(this))}static accumulateDelta(e,t){for(const[n,r]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=r;continue}let a=e[n];if(a==null){e[n]=r;continue}if(n==="index"||n==="type"){e[n]=r;continue}if(typeof a=="string"&&typeof r=="string")a+=r;else if(typeof a=="number"&&typeof r=="number")a+=r;else if(fn(a)&&fn(r))a=this.accumulateDelta(a,r);else if(Array.isArray(a)&&Array.isArray(r)){if(a.every(i=>typeof i=="string"||typeof i=="number")){a.push(...r);continue}for(const i of r){if(!fn(i))throw new Error(`Expected array delta entry to be an object but got: ${i}`);const o=i.index;if(o==null)throw console.error(i),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const d=a[o];d==null?a.push(i):a[o]=this.accumulateDelta(d,i)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${r}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,r){return await this._createAssistantStream(t,e,n,r)}async _runToolAssistantStream(e,t,n,r,a){return await this._createToolAssistantStream(n,e,t,r,a)}}rt=function(e){if(!this.ended)switch(Q(this,Lt,e,"f"),E(this,q,"m",Mr).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":E(this,q,"m",Fr).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":E(this,q,"m",$r).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":E(this,q,"m",Tr).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},at=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");if(!E(this,Oe,"f"))throw Error("Final run has not been received");return E(this,Oe,"f")},Tr=function(e){const[t,n]=E(this,q,"m",Nr).call(this,e,E(this,ae,"f"));Q(this,ae,t,"f"),E(this,kt,"f")[t.id]=t;for(const r of n){const a=t.content[r.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const r of e.data.delta.content){if(r.type=="text"&&r.text){let a=r.text,i=t.content[r.index];if(i&&i.type=="text")this._emit("textDelta",a,i.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=E(this,Ne,"f")){if(E(this,Pe,"f"))switch(E(this,Pe,"f").type){case"text":this._emit("textDone",E(this,Pe,"f").text,E(this,ae,"f"));break;case"image_file":this._emit("imageFileDone",E(this,Pe,"f").image_file,E(this,ae,"f"));break}Q(this,Ne,r.index,"f")}Q(this,Pe,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(E(this,Ne,"f")!==void 0){const r=e.data.content[E(this,Ne,"f")];if(r)switch(r.type){case"image_file":this._emit("imageFileDone",r.image_file,E(this,ae,"f"));break;case"text":this._emit("textDone",r.text,E(this,ae,"f"));break}}E(this,ae,"f")&&this._emit("messageDone",e.data),Q(this,ae,void 0,"f")}},$r=function(e){const t=E(this,q,"m",kr).call(this,e);switch(Q(this,st,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of n.step_details.tool_calls)a.index==E(this,Nt,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(E(this,Z,"f")&&this._emit("toolCallDone",E(this,Z,"f")),Q(this,Nt,a.index,"f"),Q(this,Z,t.step_details.tool_calls[a.index],"f"),E(this,Z,"f")&&this._emit("toolCallCreated",E(this,Z,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Q(this,st,void 0,"f"),e.data.step_details.type=="tool_calls"&&E(this,Z,"f")&&(this._emit("toolCallDone",E(this,Z,"f")),Q(this,Z,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Mr=function(e){E(this,wn,"f").push(e),this._emit("event",e)},kr=function(e){switch(e.event){case"thread.run.step.created":return E(this,ue,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=E(this,ue,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const r=ie.accumulateDelta(t,n.delta);E(this,ue,"f")[e.data.id]=r}return E(this,ue,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":E(this,ue,"f")[e.data.id]=e.data;break}if(E(this,ue,"f")[e.data.id])return E(this,ue,"f")[e.data.id];throw new Error("No snapshot available")},Nr=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let r=e.data;if(r.delta.content)for(const a of r.delta.content)if(a.index in t.content){let i=t.content[a.index];t.content[a.index]=E(this,q,"m",Lr).call(this,a,i)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Lr=function(e,t){return ie.accumulateDelta(t,e)},Fr=function(e){switch(Q(this,Ft,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":Q(this,Oe,e.data,"f"),E(this,Z,"f")&&(this._emit("toolCallDone",E(this,Z,"f")),Q(this,Z,void 0,"f"));break}};class _n extends O{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return L(e)?this.list({},e):this._client.getAPIList("/assistants",yn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class yn extends U{}_n.AssistantsPage=yn;function Dr(s){return typeof s.parse=="function"}const Le=s=>(s==null?void 0:s.role)==="assistant",Br=s=>(s==null?void 0:s.role)==="function",Ur=s=>(s==null?void 0:s.role)==="tool";function An(s){return(s==null?void 0:s.$brand)==="auto-parseable-response-format"}function it(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function go(s,e){return!e||!jr(e)?{...s,choices:s.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:bn(s,e)}function bn(s,e){const t=s.choices.map(n=>{var r;if(n.finish_reason==="length")throw new cr;if(n.finish_reason==="content_filter")throw new lr;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:((r=n.message.tool_calls)==null?void 0:r.map(a=>po(e,a)))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?mo(e,n.message.content):null}}});return{...s,choices:t}}function mo(s,e){var t,n;return((t=s.response_format)==null?void 0:t.type)!=="json_schema"?null:((n=s.response_format)==null?void 0:n.type)==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(e):JSON.parse(e):null}function po(s,e){var n;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:it(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function wo(s,e){var n;if(!s)return!1;const t=(n=s.tools)==null?void 0:n.find(r=>{var a;return((a=r.function)==null?void 0:a.name)===e.function.name});return it(t)||(t==null?void 0:t.function.strict)||!1}function jr(s){var e;return An(s.response_format)?!0:((e=s.tools)==null?void 0:e.some(t=>it(t)||t.type==="function"&&t.function.strict===!0))??!1}function _o(s){for(const e of s??[]){if(e.type!=="function")throw new R(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new R(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var J=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},K,xn,Dt,vn,Cn,En,Vr,Sn;const Gr=10;class Hr extends pn{constructor(){super(...arguments),K.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var n;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(n=e.choices[0])==null?void 0:n.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Br(e)||Ur(e))&&e.content)this._emit("functionCallResult",e.content);else if(Le(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Le(e)&&e.tool_calls)for(const n of e.tool_calls)n.type==="function"&&this._emit("functionCall",n.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new R("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),J(this,K,"m",xn).call(this)}async finalMessage(){return await this.done(),J(this,K,"m",Dt).call(this)}async finalFunctionCall(){return await this.done(),J(this,K,"m",vn).call(this)}async finalFunctionCallResult(){return await this.done(),J(this,K,"m",Cn).call(this)}async totalUsage(){return await this.done(),J(this,K,"m",En).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=J(this,K,"m",Dt).call(this);t&&this._emit("finalMessage",t);const n=J(this,K,"m",xn).call(this);n&&this._emit("finalContent",n);const r=J(this,K,"m",vn).call(this);r&&this._emit("finalFunctionCall",r);const a=J(this,K,"m",Cn).call(this);a!=null&&this._emit("finalFunctionCallResult",a),this._chatCompletions.some(i=>i.usage)&&this._emit("totalUsage",J(this,K,"m",En).call(this))}async _createChatCompletion(e,t,n){const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),J(this,K,"m",Vr).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(bn(a,t))}async _runChatCompletion(e,t,n){for(const r of t.messages)this._addMessage(r,!1);return await this._createChatCompletion(e,t,n)}async _runFunctions(e,t,n){var A;const r="function",{function_call:a="auto",stream:i,...o}=t,d=typeof a!="string"&&(a==null?void 0:a.name),{maxChatCompletions:h=Gr}=n||{},b={};for(const w of t.functions)b[w.name||w.function.name]=w;const g=t.functions.map(w=>({name:w.name||w.function.name,parameters:w.parameters,description:w.description}));for(const w of t.messages)this._addMessage(w,!1);for(let w=0;w<h;++w){const l=(A=(await this._createChatCompletion(e,{...o,function_call:a,functions:g,messages:[...this.messages]},n)).choices[0])==null?void 0:A.message;if(!l)throw new R("missing message in ChatCompletion response");if(!l.function_call)return;const{name:c,arguments:f}=l.function_call,u=b[c];if(u){if(d&&d!==c){const m=`Invalid function_call: ${JSON.stringify(c)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:r,name:c,content:m});continue}}else{const m=`Invalid function_call: ${JSON.stringify(c)}. Available options are: ${g.map(p=>JSON.stringify(p.name)).join(", ")}. Please try again`;this._addMessage({role:r,name:c,content:m});continue}let _;try{_=Dr(u)?await u.parse(f):f}catch(m){this._addMessage({role:r,name:c,content:m instanceof Error?m.message:String(m)});continue}const y=await u.function(_,this),I=J(this,K,"m",Sn).call(this,y);if(this._addMessage({role:r,name:c,content:I}),d)return}}async _runTools(e,t,n){var w,x,l;const r="tool",{tool_choice:a="auto",stream:i,...o}=t,d=typeof a!="string"&&((w=a==null?void 0:a.function)==null?void 0:w.name),{maxChatCompletions:h=Gr}=n||{},b=t.tools.map(c=>{if(it(c)){if(!c.$callback)throw new R("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:c.$callback,name:c.function.name,description:c.function.description||"",parameters:c.function.parameters,parse:c.$parseRaw,strict:!0}}}return c}),g={};for(const c of b)c.type==="function"&&(g[c.function.name||c.function.function.name]=c.function);const A="tools"in t?b.map(c=>c.type==="function"?{type:"function",function:{name:c.function.name||c.function.function.name,parameters:c.function.parameters,description:c.function.description,strict:c.function.strict}}:c):void 0;for(const c of t.messages)this._addMessage(c,!1);for(let c=0;c<h;++c){const u=(x=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:A,messages:[...this.messages]},n)).choices[0])==null?void 0:x.message;if(!u)throw new R("missing message in ChatCompletion response");if(!((l=u.tool_calls)!=null&&l.length))return;for(const _ of u.tool_calls){if(_.type!=="function")continue;const y=_.id,{name:I,arguments:m}=_.function,p=g[I];if(p){if(d&&d!==I){const $=`Invalid tool_call: ${JSON.stringify(I)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:r,tool_call_id:y,content:$});continue}}else{const $=`Invalid tool_call: ${JSON.stringify(I)}. Available options are: ${Object.keys(g).map(M=>JSON.stringify(M)).join(", ")}. Please try again`;this._addMessage({role:r,tool_call_id:y,content:$});continue}let v;try{v=Dr(p)?await p.parse(m):m}catch($){const M=$ instanceof Error?$.message:String($);this._addMessage({role:r,tool_call_id:y,content:M});continue}const C=await p.function(v,this),S=J(this,K,"m",Sn).call(this,C);if(this._addMessage({role:r,tool_call_id:y,content:S}),d)return}}}}K=new WeakSet,xn=function(){return J(this,K,"m",Dt).call(this).content??null},Dt=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Le(t)){const{function_call:n,...r}=t,a={...r,content:t.content??null,refusal:t.refusal??null};return n&&(a.function_call=n),a}}throw new R("stream ended without producing a ChatCompletionMessage with role=assistant")},vn=function(){var e,t;for(let n=this.messages.length-1;n>=0;n--){const r=this.messages[n];if(Le(r)&&(r!=null&&r.function_call))return r.function_call;if(Le(r)&&((e=r==null?void 0:r.tool_calls)!=null&&e.length))return(t=r.tool_calls.at(-1))==null?void 0:t.function}},Cn=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Br(t)&&t.content!=null||Ur(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>{var r;return n.role==="assistant"&&((r=n.tool_calls)==null?void 0:r.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},En=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Vr=function(e){if(e.n!=null&&e.n>1)throw new R("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Sn=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class ot extends Hr{static runFunctions(e,t,n){const r=new ot,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,a)),r}static runTools(e,t,n){const r=new ot,a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}_addMessage(e,t=!0){super._addMessage(e,t),Le(e)&&e.content&&this._emit("content",e.content)}}const qr=1,Kr=2,Wr=4,Jr=8,Xr=16,Yr=32,zr=64,Qr=128,Zr=256,ea=Qr|Zr,ta=Xr|Yr|ea|zr,na=qr|Kr|ta,sa=Wr|Jr,yo=na|sa,V={STR:qr,NUM:Kr,ARR:Wr,OBJ:Jr,NULL:Xr,BOOL:Yr,NAN:zr,INFINITY:Qr,MINUS_INFINITY:Zr,INF:ea,SPECIAL:ta,ATOM:na,COLLECTION:sa,ALL:yo};class Ao extends Error{}class bo extends Error{}function xo(s,e=V.ALL){if(typeof s!="string")throw new TypeError(`expecting str, got ${typeof s}`);if(!s.trim())throw new Error(`${s} is empty`);return vo(s.trim(),e)}const vo=(s,e)=>{const t=s.length;let n=0;const r=A=>{throw new Ao(`${A} at position ${n}`)},a=A=>{throw new bo(`${A} at position ${n}`)},i=()=>(g(),n>=t&&r("Unexpected end of input"),s[n]==='"'?o():s[n]==="{"?d():s[n]==="["?h():s.substring(n,n+4)==="null"||V.NULL&e&&t-n<4&&"null".startsWith(s.substring(n))?(n+=4,null):s.substring(n,n+4)==="true"||V.BOOL&e&&t-n<4&&"true".startsWith(s.substring(n))?(n+=4,!0):s.substring(n,n+5)==="false"||V.BOOL&e&&t-n<5&&"false".startsWith(s.substring(n))?(n+=5,!1):s.substring(n,n+8)==="Infinity"||V.INFINITY&e&&t-n<8&&"Infinity".startsWith(s.substring(n))?(n+=8,1/0):s.substring(n,n+9)==="-Infinity"||V.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(s.substring(n))?(n+=9,-1/0):s.substring(n,n+3)==="NaN"||V.NAN&e&&t-n<3&&"NaN".startsWith(s.substring(n))?(n+=3,NaN):b()),o=()=>{const A=n;let w=!1;for(n++;n<t&&(s[n]!=='"'||w&&s[n-1]==="\\");)w=s[n]==="\\"?!w:!1,n++;if(s.charAt(n)=='"')try{return JSON.parse(s.substring(A,++n-Number(w)))}catch(x){a(String(x))}else if(V.STR&e)try{return JSON.parse(s.substring(A,n-Number(w))+'"')}catch{return JSON.parse(s.substring(A,s.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},d=()=>{n++,g();const A={};try{for(;s[n]!=="}";){if(g(),n>=t&&V.OBJ&e)return A;const w=o();g(),n++;try{const x=i();Object.defineProperty(A,w,{value:x,writable:!0,enumerable:!0,configurable:!0})}catch(x){if(V.OBJ&e)return A;throw x}g(),s[n]===","&&n++}}catch{if(V.OBJ&e)return A;r("Expected '}' at end of object")}return n++,A},h=()=>{n++;const A=[];try{for(;s[n]!=="]";)A.push(i()),g(),s[n]===","&&n++}catch{if(V.ARR&e)return A;r("Expected ']' at end of array")}return n++,A},b=()=>{if(n===0){s==="-"&&V.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s)}catch(w){if(V.NUM&e)try{return s[s.length-1]==="."?JSON.parse(s.substring(0,s.lastIndexOf("."))):JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch{}a(String(w))}}const A=n;for(s[n]==="-"&&n++;s[n]&&!",]}".includes(s[n]);)n++;n==t&&!(V.NUM&e)&&r("Unterminated number literal");try{return JSON.parse(s.substring(A,n))}catch{s.substring(A,n)==="-"&&V.NUM&e&&r("Not sure what '-' is");try{return JSON.parse(s.substring(A,s.lastIndexOf("e")))}catch(x){a(String(x))}}},g=()=>{for(;n<t&&` 
\r	`.includes(s[n]);)n++};return i()},ra=s=>xo(s,V.ALL^V.NUM);var Fe=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},k=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},j,ge,De,_e,Rn,Bt,In,On,Pn,Ut,Tn,aa;class ct extends Hr{constructor(e){super(),j.add(this),ge.set(this,void 0),De.set(this,void 0),_e.set(this,void 0),Fe(this,ge,e,"f"),Fe(this,De,[],"f")}get currentChatCompletionSnapshot(){return k(this,_e,"f")}static fromReadableStream(e){const t=new ct(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const r=new ct(t);return r._run(()=>r._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createChatCompletion(e,t,n){var i;super._createChatCompletion;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),k(this,j,"m",Rn).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(const o of a)k(this,j,"m",In).call(this,o);if((i=a.controller.signal)!=null&&i.aborted)throw new te;return this._addChatCompletion(k(this,j,"m",Ut).call(this))}async _fromReadableStream(e,t){var i;const n=t==null?void 0:t.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),k(this,j,"m",Rn).call(this),this._connected();const r=le.fromReadableStream(e,this.controller);let a;for await(const o of r)a&&a!==o.id&&this._addChatCompletion(k(this,j,"m",Ut).call(this)),k(this,j,"m",In).call(this,o),a=o.id;if((i=r.controller.signal)!=null&&i.aborted)throw new te;return this._addChatCompletion(k(this,j,"m",Ut).call(this))}[(ge=new WeakMap,De=new WeakMap,_e=new WeakMap,j=new WeakSet,Rn=function(){this.ended||Fe(this,_e,void 0,"f")},Bt=function(t){let n=k(this,De,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},k(this,De,"f")[t.index]=n,n)},In=function(t){var r,a,i,o,d,h,b,g,A,w,x,l,c,f,u;if(this.ended)return;const n=k(this,j,"m",aa).call(this,t);this._emit("chunk",t,n);for(const _ of t.choices){const y=n.choices[_.index];_.delta.content!=null&&((r=y.message)==null?void 0:r.role)==="assistant"&&((a=y.message)!=null&&a.content)&&(this._emit("content",_.delta.content,y.message.content),this._emit("content.delta",{delta:_.delta.content,snapshot:y.message.content,parsed:y.message.parsed})),_.delta.refusal!=null&&((i=y.message)==null?void 0:i.role)==="assistant"&&((o=y.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:_.delta.refusal,snapshot:y.message.refusal}),((d=_.logprobs)==null?void 0:d.content)!=null&&((h=y.message)==null?void 0:h.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(b=_.logprobs)==null?void 0:b.content,snapshot:((g=y.logprobs)==null?void 0:g.content)??[]}),((A=_.logprobs)==null?void 0:A.refusal)!=null&&((w=y.message)==null?void 0:w.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(x=_.logprobs)==null?void 0:x.refusal,snapshot:((l=y.logprobs)==null?void 0:l.refusal)??[]});const I=k(this,j,"m",Bt).call(this,y);y.finish_reason&&(k(this,j,"m",Pn).call(this,y),I.current_tool_call_index!=null&&k(this,j,"m",On).call(this,y,I.current_tool_call_index));for(const m of _.delta.tool_calls??[])I.current_tool_call_index!==m.index&&(k(this,j,"m",Pn).call(this,y),I.current_tool_call_index!=null&&k(this,j,"m",On).call(this,y,I.current_tool_call_index)),I.current_tool_call_index=m.index;for(const m of _.delta.tool_calls??[]){const p=(c=y.message.tool_calls)==null?void 0:c[m.index];p!=null&&p.type&&((p==null?void 0:p.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(f=p.function)==null?void 0:f.name,index:m.index,arguments:p.function.arguments,parsed_arguments:p.function.parsed_arguments,arguments_delta:((u=m.function)==null?void 0:u.arguments)??""}):(p==null||p.type,void 0))}}},On=function(t,n){var i,o,d;if(k(this,j,"m",Bt).call(this,t).done_tool_calls.has(n))return;const a=(i=t.message.tool_calls)==null?void 0:i[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const h=(d=(o=k(this,ge,"f"))==null?void 0:o.tools)==null?void 0:d.find(b=>b.type==="function"&&b.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:it(h)?h.$parseRaw(a.function.arguments):h!=null&&h.function.strict?JSON.parse(a.function.arguments):null})}else a.type},Pn=function(t){var r,a;const n=k(this,j,"m",Bt).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;const i=k(this,j,"m",Tn).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(r=t.logprobs)!=null&&r.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Ut=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");const t=k(this,_e,"f");if(!t)throw new R("request ended without sending any chunks");return Fe(this,_e,void 0,"f"),Fe(this,De,[],"f"),Co(t,k(this,ge,"f"))},Tn=function(){var n;const t=(n=k(this,ge,"f"))==null?void 0:n.response_format;return An(t)?t:null},aa=function(t){var n,r,a,i;let o=k(this,_e,"f");const{choices:d,...h}=t;o?Object.assign(o,h):o=Fe(this,_e,{...h,choices:[]},"f");for(const{delta:b,finish_reason:g,index:A,logprobs:w=null,...x}of t.choices){let l=o.choices[A];if(l||(l=o.choices[A]={finish_reason:g,index:A,message:{},logprobs:w,...x}),w)if(!l.logprobs)l.logprobs=Object.assign({},w);else{const{content:m,refusal:p,...v}=w;Object.assign(l.logprobs,v),m&&((n=l.logprobs).content??(n.content=[]),l.logprobs.content.push(...m)),p&&((r=l.logprobs).refusal??(r.refusal=[]),l.logprobs.refusal.push(...p))}if(g&&(l.finish_reason=g,k(this,ge,"f")&&jr(k(this,ge,"f")))){if(g==="length")throw new cr;if(g==="content_filter")throw new lr}if(Object.assign(l,x),!b)continue;const{content:c,refusal:f,function_call:u,role:_,tool_calls:y,...I}=b;if(Object.assign(l.message,I),f&&(l.message.refusal=(l.message.refusal||"")+f),_&&(l.message.role=_),u&&(l.message.function_call?(u.name&&(l.message.function_call.name=u.name),u.arguments&&((a=l.message.function_call).arguments??(a.arguments=""),l.message.function_call.arguments+=u.arguments)):l.message.function_call=u),c&&(l.message.content=(l.message.content||"")+c,!l.message.refusal&&k(this,j,"m",Tn).call(this)&&(l.message.parsed=ra(l.message.content))),y){l.message.tool_calls||(l.message.tool_calls=[]);for(const{index:m,id:p,type:v,function:C,...S}of y){const $=(i=l.message.tool_calls)[m]??(i[m]={});Object.assign($,S),p&&($.id=p),v&&($.type=v),C&&($.function??($.function={name:C.name??"",arguments:""})),C!=null&&C.name&&($.function.name=C.name),C!=null&&C.arguments&&($.function.arguments+=C.arguments,wo(k(this,ge,"f"),$)&&($.function.parsed_arguments=ra($.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("chunk",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new le(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function Co(s,e){const{id:t,choices:n,created:r,model:a,system_fingerprint:i,...o}=s,d={...o,id:t,choices:n.map(({message:h,finish_reason:b,index:g,logprobs:A,...w})=>{if(!b)throw new R(`missing finish_reason for choice ${g}`);const{content:x=null,function_call:l,tool_calls:c,...f}=h,u=h.role;if(!u)throw new R(`missing role for choice ${g}`);if(l){const{arguments:_,name:y}=l;if(_==null)throw new R(`missing function_call.arguments for choice ${g}`);if(!y)throw new R(`missing function_call.name for choice ${g}`);return{...w,message:{content:x,function_call:{arguments:_,name:y},role:u,refusal:h.refusal??null},finish_reason:b,index:g,logprobs:A}}return c?{...w,index:g,finish_reason:b,logprobs:A,message:{...f,role:u,content:x,refusal:h.refusal??null,tool_calls:c.map((_,y)=>{const{function:I,type:m,id:p,...v}=_,{arguments:C,name:S,...$}=I||{};if(p==null)throw new R(`missing choices[${g}].tool_calls[${y}].id
${jt(s)}`);if(m==null)throw new R(`missing choices[${g}].tool_calls[${y}].type
${jt(s)}`);if(S==null)throw new R(`missing choices[${g}].tool_calls[${y}].function.name
${jt(s)}`);if(C==null)throw new R(`missing choices[${g}].tool_calls[${y}].function.arguments
${jt(s)}`);return{...v,id:p,type:m,function:{...$,name:S,arguments:C}}})}}:{...w,message:{...f,content:x,role:u,refusal:h.refusal??null},finish_reason:b,index:g,logprobs:A}}),created:r,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return go(d,e)}function jt(s){return JSON.stringify(s)}function gc(s){}class Be extends ct{static fromReadableStream(e){const t=new Be(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const r=new Be(null),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runFunctions"}};return r._run(()=>r._runFunctions(e,t,a)),r}static runTools(e,t,n){const r=new Be(t),a={...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"runTools"}};return r._run(()=>r._runTools(e,t,a)),r}}let ia=class extends O{parse(e,t){return _o(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(n=>bn(n,e))}runFunctions(e,t){return e.stream?Be.runFunctions(this._client,e,t):ot.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Be.runTools(this._client,e,t):ot.runTools(this._client,e,t)}stream(e,t){return ct.createChatCompletion(this._client,e,t)}};class $n extends O{constructor(){super(...arguments),this.completions=new ia(this._client)}}(function(s){s.Completions=ia})($n||($n={}));class oa extends O{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class ca extends O{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}}class Vt extends O{constructor(){super(...arguments),this.sessions=new oa(this._client),this.transcriptionSessions=new ca(this._client)}}Vt.Sessions=oa,Vt.TranscriptionSessions=ca;class Mn extends O{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return L(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,kn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class kn extends U{}Mn.MessagesPage=kn;class Nn extends O{retrieve(e,t,n,r={},a){return L(r)?this.retrieve(e,t,n,{},r):this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{query:r,...a,headers:{"OpenAI-Beta":"assistants=v2",...a==null?void 0:a.headers}})}list(e,t,n={},r){return L(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Ln,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Ln extends U{}Nn.RunStepsPage=Ln;let lt=class extends O{constructor(){super(...arguments),this.steps=new Nn(this._client)}create(e,t,n){const{include:r,...a}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:r},body:a,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return L(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Fn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}createAndStream(e,t,n){return ie.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:{...n==null?void 0:n.headers,...r}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const d=i.headers.get("openai-poll-after-ms");if(d){const h=parseInt(d);isNaN(h)||(o=h)}}await ze(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return ie.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,r){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}async submitToolOutputsAndPoll(e,t,n,r){const a=await this.submitToolOutputs(e,t,n,r);return await this.poll(e,a.id,r)}submitToolOutputsStream(e,t,n,r){return ie.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,r)}};class Fn extends U{}lt.RunsPage=Fn,lt.Steps=Nn,lt.RunStepsPage=Ln;class Ue extends O{constructor(){super(...arguments),this.runs=new lt(this._client),this.messages=new Mn(this._client)}create(e={},t){return L(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const n=await this.createAndRun(e,t);return await this.runs.poll(n.thread_id,n.id,t)}createAndRunStream(e,t){return ie.createThreadAssistantStream(e,this._client.beta.threads,t)}}Ue.Runs=lt,Ue.RunsPage=Fn,Ue.Messages=Mn,Ue.MessagesPage=kn;class je extends O{constructor(){super(...arguments),this.realtime=new Vt(this._client),this.chat=new $n(this._client),this.assistants=new _n(this._client),this.threads=new Ue(this._client)}}je.Realtime=Vt,je.Assistants=_n,je.AssistantsPage=yn,je.Threads=Ue;class la extends O{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class ua extends O{retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}}let Gt=class extends O{constructor(){super(...arguments),this.content=new ua(this._client)}create(e,t,n){return this._client.post(`/containers/${e}/files`,Ie({body:t,...n}))}retrieve(e,t,n){return this._client.get(`/containers/${e}/files/${t}`,n)}list(e,t={},n){return L(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,Dn,{query:t,...n})}del(e,t,n){return this._client.delete(`/containers/${e}/files/${t}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}};class Dn extends U{}Gt.FileListResponsesPage=Dn,Gt.Content=ua;class ut extends O{constructor(){super(...arguments),this.files=new Gt(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return L(e)?this.list({},e):this._client.getAPIList("/containers",Bn,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}}class Bn extends U{}ut.ContainerListResponsesPage=Bn,ut.Files=Gt,ut.FileListResponsesPage=Dn;class da extends O{create(e,t){const n=!!e.encoding_format;let r=n?e.encoding_format:"base64";n&&we("Request","User defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:r},...t});return n?a:(we("response","Decoding base64 embeddings to float32 array"),a._thenUnwrap(i=>(i&&i.data&&i.data.forEach(o=>{const d=o.embedding;o.embedding=fo(d)}),i)))}}class Un extends O{retrieve(e,t,n,r){return this._client.get(`/evals/${e}/runs/${t}/output_items/${n}`,r)}list(e,t,n={},r){return L(n)?this.list(e,t,{},n):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,jn,{query:n,...r})}}class jn extends U{}Un.OutputItemListResponsesPage=jn;class dt extends O{constructor(){super(...arguments),this.outputItems=new Un(this._client)}create(e,t,n){return this._client.post(`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){return this._client.get(`/evals/${e}/runs/${t}`,n)}list(e,t={},n){return L(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,Vn,{query:t,...n})}del(e,t,n){return this._client.delete(`/evals/${e}/runs/${t}`,n)}cancel(e,t,n){return this._client.post(`/evals/${e}/runs/${t}`,n)}}class Vn extends U{}dt.RunListResponsesPage=Vn,dt.OutputItems=Un,dt.OutputItemListResponsesPage=jn;class ft extends O{constructor(){super(...arguments),this.runs=new dt(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,n){return this._client.post(`/evals/${e}`,{body:t,...n})}list(e={},t){return L(e)?this.list({},e):this._client.getAPIList("/evals",Gn,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class Gn extends U{}ft.EvalListResponsesPage=Gn,ft.Runs=dt,ft.RunListResponsesPage=Vn;let Hn=class extends O{create(e,t){return this._client.post("/files",Ie({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return L(e)?this.list({},e):this._client.getAPIList("/files",qn,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t==null?void 0:t.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=1800*1e3}={}){const r=new Set(["processed","error","deleted"]),a=Date.now();let i=await this.retrieve(e);for(;!i.status||!r.has(i.status);)if(await ze(t),i=await this.retrieve(e),Date.now()-a>n)throw new on({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return i}};class qn extends U{}Hn.FileObjectsPage=qn;class fa extends O{}let ha=class extends O{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class Kn extends O{constructor(){super(...arguments),this.graders=new ha(this._client)}}Kn.Graders=ha;class Wn extends O{create(e,t,n){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,Jn,{body:t,method:"post",...n})}retrieve(e,t={},n){return L(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}del(e,t,n){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,n)}}class Jn extends Et{}Wn.PermissionCreateResponsesPage=Jn;let Ht=class extends O{constructor(){super(...arguments),this.permissions=new Wn(this._client)}};Ht.Permissions=Wn,Ht.PermissionCreateResponsesPage=Jn;class Xn extends O{list(e,t={},n){return L(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Yn,{query:t,...n})}}class Yn extends U{}Xn.FineTuningJobCheckpointsPage=Yn;class Ve extends O{constructor(){super(...arguments),this.checkpoints=new Xn(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return L(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",zn,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return L(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,Qn,{query:t,...n})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class zn extends U{}class Qn extends U{}Ve.FineTuningJobsPage=zn,Ve.FineTuningJobEventsPage=Qn,Ve.Checkpoints=Xn,Ve.FineTuningJobCheckpointsPage=Yn;class ye extends O{constructor(){super(...arguments),this.methods=new fa(this._client),this.jobs=new Ve(this._client),this.checkpoints=new Ht(this._client),this.alpha=new Kn(this._client)}}ye.Methods=fa,ye.Jobs=Ve,ye.FineTuningJobsPage=zn,ye.FineTuningJobEventsPage=Qn,ye.Checkpoints=Ht,ye.Alpha=Kn;class ga extends O{}class Zn extends O{constructor(){super(...arguments),this.graderModels=new ga(this._client)}}Zn.GraderModels=ga;class ma extends O{createVariation(e,t){return this._client.post("/images/variations",Ie({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Ie({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class es extends O{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",ts,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class ts extends Et{}es.ModelsPage=ts;class pa extends O{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function Eo(s,e){return!e||!Ro(e)?{...s,output_parsed:null,output:s.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:wa(s,e)}function wa(s,e){const t=s.output.map(r=>{if(r.type==="function_call")return{...r,parsed_arguments:Po(e,r)};if(r.type==="message"){const a=r.content.map(i=>i.type==="output_text"?{...i,parsed:So(e,i.text)}:i);return{...r,content:a}}return r}),n=Object.assign({},s,{output:t});return Object.getOwnPropertyDescriptor(s,"output_text")||_a(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(const r of n.output)if(r.type==="message"){for(const a of r.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function So(s,e){var t,n,r,a;return((n=(t=s.text)==null?void 0:t.format)==null?void 0:n.type)!=="json_schema"?null:"$parseRaw"in((r=s.text)==null?void 0:r.format)?((a=s.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function Ro(s){var e;return!!An((e=s.text)==null?void 0:e.format)}function Io(s){return(s==null?void 0:s.$brand)==="auto-parseable-tool"}function Oo(s,e){return s.find(t=>t.type==="function"&&t.name===e)}function Po(s,e){const t=Oo(s.tools??[],e.name);return{...e,...e,parsed_arguments:Io(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function _a(s){const e=[];for(const t of s.output)if(t.type==="message")for(const n of t.content)n.type==="output_text"&&e.push(n.text);s.output_text=e.join("")}class ya extends O{list(e,t={},n){return L(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,$o,{query:t,...n})}}var Ge=function(s,e,t,n,r){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?s!==e||!r:!e.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?r.call(s,t):r?r.value=t:e.set(s,t),t},Ae=function(s,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?s!==e||!n:!e.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(s):n?n.value:e.get(s)},He,qt,be,Kt,Aa,ba,xa,va;class ns extends pn{constructor(e){super(),He.add(this),qt.set(this,void 0),be.set(this,void 0),Kt.set(this,void 0),Ge(this,qt,e,"f")}static createResponse(e,t,n){const r=new ns(t);return r._run(()=>r._createOrRetrieveResponse(e,t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createOrRetrieveResponse(e,t,n){var o;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ae(this,He,"m",Aa).call(this);let a,i=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(const d of a)Ae(this,He,"m",ba).call(this,d,i);if((o=a.controller.signal)!=null&&o.aborted)throw new te;return Ae(this,He,"m",xa).call(this)}[(qt=new WeakMap,be=new WeakMap,Kt=new WeakMap,He=new WeakSet,Aa=function(){this.ended||Ge(this,be,void 0,"f")},ba=function(t,n){if(this.ended)return;const r=(i,o)=>{(n==null||o.sequence_number>n)&&this._emit(i,o)},a=Ae(this,He,"m",va).call(this,t);switch(r("event",t),t.type){case"response.output_text.delta":{const i=a.output[t.output_index];if(!i)throw new R(`missing output at index ${t.output_index}`);if(i.type==="message"){const o=i.content[t.content_index];if(!o)throw new R(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new R(`expected content to be 'output_text', got ${o.type}`);r("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const i=a.output[t.output_index];if(!i)throw new R(`missing output at index ${t.output_index}`);i.type==="function_call"&&r("response.function_call_arguments.delta",{...t,snapshot:i.arguments});break}default:r(t.type,t);break}},xa=function(){if(this.ended)throw new R("stream has ended, this shouldn't happen");const t=Ae(this,be,"f");if(!t)throw new R("request ended without sending any events");Ge(this,be,void 0,"f");const n=To(t,Ae(this,qt,"f"));return Ge(this,Kt,n,"f"),n},va=function(t){let n=Ae(this,be,"f");if(!n){if(t.type!=="response.created")throw new R(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=Ge(this,be,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{const r=n.output[t.output_index];if(!r)throw new R(`missing output at index ${t.output_index}`);r.type==="message"&&r.content.push(t.part);break}case"response.output_text.delta":{const r=n.output[t.output_index];if(!r)throw new R(`missing output at index ${t.output_index}`);if(r.type==="message"){const a=r.content[t.content_index];if(!a)throw new R(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new R(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const r=n.output[t.output_index];if(!r)throw new R(`missing output at index ${t.output_index}`);r.type==="function_call"&&(r.arguments+=t.delta);break}case"response.completed":{Ge(this,be,t.response,"f");break}}return n},Symbol.asyncIterator)](){const e=[],t=[];let n=!1;return this.on("event",r=>{const a=t.shift();a?a.resolve(r):e.push(r)}),this.on("end",()=>{n=!0;for(const r of t)r.resolve(void 0);t.length=0}),this.on("abort",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),this.on("error",r=>{n=!0;for(const a of t)a.reject(r);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,i)=>t.push({resolve:a,reject:i})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Ae(this,Kt,"f");if(!e)throw new R("stream ended without producing a ChatCompletion");return e}}function To(s,e){return Eo(s,e)}class ss extends O{constructor(){super(...arguments),this.inputItems=new ya(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&_a(n),n))}retrieve(e,t={},n){return this._client.get(`/responses/${e}`,{query:t,...n,stream:(t==null?void 0:t.stream)??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>wa(n,e))}stream(e,t){return ns.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t==null?void 0:t.headers}})}}class $o extends U{}ss.InputItems=ya;class Ca extends O{create(e,t,n){return this._client.post(`/uploads/${e}/parts`,Ie({body:t,...n}))}}class rs extends O{constructor(){super(...arguments),this.parts=new Ca(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(`/uploads/${e}/complete`,{body:t,...n})}}rs.Parts=Ca;const Mo=async s=>{const e=await Promise.allSettled(s),t=e.filter(r=>r.status==="rejected");if(t.length){for(const r of t)console.error(r.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const n=[];for(const r of e)r.status==="fulfilled"&&n.push(r.value);return n};class Wt extends O{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(e,t,n,r){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(e,t={},n){return L(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Jt,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t,n);return await this.poll(e,r.id,n)}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=await this.retrieve(e,t,{...n,headers:r}).withResponse(),i=a.data;switch(i.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const d=a.response.headers.get("openai-poll-after-ms");if(d){const h=parseInt(d);isNaN(h)||(o=h)}}await ze(o);break;case"failed":case"completed":return i}}}async upload(e,t,n){const r=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:r.id},n)}async uploadAndPoll(e,t,n){const r=await this.upload(e,t,n);return await this.poll(e,r.id,n)}content(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,as,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Jt extends U{}class as extends Et{}Wt.VectorStoreFilesPage=Jt,Wt.FileContentResponsesPage=as;class Ea extends O{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}async createAndPoll(e,t,n){const r=await this.create(e,t);return await this.poll(e,r.id,n)}listFiles(e,t,n={},r){return L(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Jt,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async poll(e,t,n){const r={...n==null?void 0:n.headers,"X-Stainless-Poll-Helper":"true"};for(n!=null&&n.pollIntervalMs&&(r["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:i}=await this.retrieve(e,t,{...n,headers:r}).withResponse();switch(a.status){case"in_progress":let o=5e3;if(n!=null&&n.pollIntervalMs)o=n.pollIntervalMs;else{const d=i.headers.get("openai-poll-after-ms");if(d){const h=parseInt(d);isNaN(h)||(o=h)}}await ze(o);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},r){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(r==null?void 0:r.maxConcurrency)??5,i=Math.min(a,t.length),o=this._client,d=t.values(),h=[...n];async function b(A){for(let w of A){const x=await o.files.create({file:w,purpose:"assistants"},r);h.push(x.id)}}const g=Array(i).fill(d).map(b);return await Mo(g),await this.createAndPoll(e,{file_ids:h})}}class xe extends O{constructor(){super(...arguments),this.files=new Wt(this._client),this.fileBatches=new Ea(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}list(e={},t){return L(e)?this.list({},e):this._client.getAPIList("/vector_stores",is,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t==null?void 0:t.headers}})}search(e,t,n){return this._client.getAPIList(`/vector_stores/${e}/search`,os,{body:t,method:"post",...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class is extends U{}class os extends Et{}xe.VectorStoresPage=is,xe.VectorStoreSearchResponsesPage=os,xe.Files=Wt,xe.VectorStoreFilesPage=Jt,xe.FileContentResponsesPage=as,xe.FileBatches=Ea;var Sa;class T extends Zi{constructor({baseURL:e=vt("OPENAI_BASE_URL"),apiKey:t=vt("OPENAI_API_KEY"),organization:n=vt("OPENAI_ORG_ID")??null,project:r=vt("OPENAI_PROJECT_ID")??null,...a}={}){if(t===void 0)throw new R("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const i={apiKey:t,organization:n,project:r,...a,baseURL:e||"https://api.openai.com/v1"};if(!i.dangerouslyAllowBrowser&&lo())throw new R(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:i.baseURL,timeout:i.timeout??6e5,httpAgent:i.httpAgent,maxRetries:i.maxRetries,fetch:i.fetch}),this.completions=new la(this),this.chat=new It(this),this.embeddings=new da(this),this.files=new Hn(this),this.images=new ma(this),this.audio=new Qe(this),this.moderations=new pa(this),this.models=new es(this),this.fineTuning=new ye(this),this.graders=new Zn(this),this.vectorStores=new xe(this),this.beta=new je(this),this.batches=new hn(this),this.uploads=new rs(this),this.responses=new ss(this),this.evals=new ft(this),this.containers=new ut(this),this._options=i,this.apiKey=t,this.organization=n,this.project=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return Ni(e,{arrayFormat:"brackets"})}}Sa=T,T.OpenAI=Sa,T.DEFAULT_TIMEOUT=6e5,T.OpenAIError=R,T.APIError=H,T.APIConnectionError=wt,T.APIConnectionTimeoutError=on,T.APIUserAbortError=te,T.NotFoundError=sr,T.ConflictError=rr,T.RateLimitError=ir,T.BadRequestError=er,T.AuthenticationError=tr,T.InternalServerError=or,T.PermissionDeniedError=nr,T.UnprocessableEntityError=ar,T.toFile=hr,T.fileFromPath=zs,T.Completions=la,T.Chat=It,T.ChatCompletionsPage=Rt,T.Embeddings=da,T.Files=Hn,T.FileObjectsPage=qn,T.Images=ma,T.Audio=Qe,T.Moderations=pa,T.Models=es,T.ModelsPage=ts,T.FineTuning=ye,T.Graders=Zn,T.VectorStores=xe,T.VectorStoresPage=is,T.VectorStoreSearchResponsesPage=os,T.Beta=je,T.Batches=hn,T.BatchesPage=gn,T.Uploads=rs,T.Responses=ss,T.Evals=ft,T.EvalListResponsesPage=Gn,T.Containers=ut,T.ContainerListResponsesPage=Bn;let cs=null;function ko(s){Y.api.info("OpenAI SDK initialized"),cs=new T({apiKey:s,dangerouslyAllowBrowser:!0})}async function No(s,e,t){var o,d,h;if(!cs)throw Y.api.error("OpenAI not initialized"),new Error("OpenAI not initialized. Call initOpenAI() first.");const n=Date.now(),r={professional:"formal but approachable",casual:"friendly and conversational",friendly:"warm and personable",expert:"knowledgeable but not condescending"};Y.logApiRequest("openai","chat.completions/generateReply",{model:"gpt-4o-mini",intent:e});const a=await cs.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:`Generate authentic, non-salesy social media replies. Be helpful, not promotional. 2-4 sentences max. No emojis unless the original post uses them. Sound human.

Your persona:
- Role: ${t.role}
- Tone: ${r[t.aiTone]}
- Value: ${t.valueProposition}`},{role:"user",content:`Intent: ${e}

Post: "${s.slice(0,1e3)}"

Generate reply:`}],temperature:.7,max_tokens:150}),i=((h=(d=(o=a.choices[0])==null?void 0:o.message)==null?void 0:d.content)==null?void 0:h.trim())||"";return Y.logApiResponse("openai","chat.completions/generateReply",{replyLength:i.length,usage:a.usage},Date.now()-n),i}const Lo=se.defineItem("local:personas",{fallback:[{id:"default",name:"Default Persona",role:"Professional",keywords:["looking for","need help","recommend","suggestions","anyone know"],negativeKeywords:["hiring","job posting","we are hiring"],aiTone:"professional",valueProposition:"I help businesses solve their problems with tailored solutions.",isActive:!0,createdAt:Date.now()}],version:1}),Fo=se.defineItem("local:activePersonaId",{fallback:"default"}),qe=se.defineItem("local:leads",{fallback:[],version:1}),Ra=se.defineItem("local:settings",{fallback:{isEnabled:!0,scanMode:"manual",scanIntervalMs:1e4,minLeadScore:50,autoAnalyze:!0,showOverlay:!0,aiProvider:"gemini",transparencyEnabled:!1,transparencyText:"[AI-assisted response]"},version:3}),ht=se.defineItem("local:watchedGroups",{fallback:[],version:1}),Ia=se.defineItem("local:sessionLimits",{fallback:{maxPostsPerHour:30,maxGroupsPerDay:10,cooldownMinutes:15,postsScannedThisHour:0,groupsVisitedToday:0,lastHourReset:Date.now(),lastDayReset:new Date().toDateString(),isPaused:!1},version:1}),ls=se.defineItem("local:usage",{fallback:{leadsFoundToday:0,aiCallsToday:0,lastResetDate:new Date().toDateString()}});se.defineItem("local:seenPostIds",{fallback:[]}),se.defineItem("local:onboardingComplete",{fallback:!1});async function Do(){const s=await Lo.getValue(),e=await Fo.getValue();return s.find(t=>t.id===e)??s[0]??null}async function Bo(s){const e=await ls.getValue(),t=new Date().toDateString();return e.lastResetDate!==t?(await ls.setValue({leadsFoundToday:0,aiCallsToday:1,lastResetDate:t}),!0):(await ls.setValue({...e,leadsFoundToday:e.leadsFoundToday+0,aiCallsToday:e.aiCallsToday+1}),!0)}async function us(s,e){const t=await ht.getValue(),n=t.findIndex(r=>r.id===s);n>=0&&(t[n]={...t[n],...e},await ht.setValue(t))}const Te=se.defineItem("local:automationSettings",{fallback:{enabled:!1,scanIntervalMinutes:30,groupsPerCycle:3,delayMinSeconds:5,delayMaxSeconds:15,isPro:!1},version:1}),G=se.defineItem("local:automationState",{fallback:{isRunning:!1,queue:[],completedCount:0,failedCount:0},version:1});async function Uo(s){const e=await G.getValue(),t={...s,id:`task_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,createdAt:Date.now()};return e.queue.push(t),await G.setValue(e),t}async function ds(s,e){const t=await G.getValue(),n=t.queue.findIndex(r=>r.id===s);n>=0&&(t.queue[n]={...t.queue[n],...e},await G.setValue(t))}async function jo(){const s=await G.getValue();s.queue=s.queue.filter(e=>e.status==="pending"||e.status==="running"),await G.setValue(s)}async function Vo(){const s=await G.getValue(),e=Date.now();return s.queue.filter(n=>n.status==="pending"&&n.scheduledAt<=e).sort((n,r)=>n.scheduledAt-r.scheduledAt)[0]||null}async function Go(s,e){const t=await qe.getValue(),n=t.findIndex(r=>r.id===s);n>=0&&(t[n].lci=e,await qe.setValue(t))}async function Ho(s){return(await qe.getValue()).find(t=>t.id===s)||null}function Oa(s,e){Y.ai.info(`Initializing AI provider: ${s}`,{provider:s,hasKey:!!e}),s==="gemini"?vi(e):ko(e)}async function qo(s,e,t){const n=await Ra.getValue(),r=Date.now();Y.ai.info("Generating reply",{provider:n.aiProvider,intent:e.intent,leadScore:e.leadScore}),await Bo();try{let a;return n.aiProvider==="openai"?a=await No(s,e.intent,t):a=await Ei(s,e.intent,t),n.transparencyEnabled&&n.transparencyText&&(a=`${a}

${n.transparencyText}`),Y.ai.info("Reply generated",{replyLength:a.length,durationMs:Date.now()-r}),a}catch(a){throw Y.ai.error("Failed to generate reply",{error:a,provider:n.aiProvider}),a}}async function Ko(s){return(await qe.getValue()).filter(t=>s.includes(t.id))}let Xt=null;async function Pa(){const s=await Te.getValue();if(!s.enabled||!s.isPro)return;await fs();const e=await G.getValue();await G.setValue({...e,isRunning:!0,startedAt:Date.now()}),await Ta(),Xt=setInterval(async()=>{await Jo()},1e4)}async function fs(){Xt&&(clearInterval(Xt),Xt=null);const s=await G.getValue();await G.setValue({...s,isRunning:!1,currentTaskId:void 0})}async function Ta(){const s=await Te.getValue(),t=(await ht.getValue()).filter(a=>a.isActive);if(t.length===0)return;t.sort((a,i)=>(a.lastVisited||0)-(i.lastVisited||0));const n=t.slice(0,s.groupsPerCycle),r=Date.now();for(let a=0;a<n.length;a++){const i=n[a],o=Wo(s,a);await Uo({type:"scan_group",groupId:i.id,groupName:i.name,scheduledAt:r+o,status:"pending"})}await Te.setValue({...s,lastScanAt:r})}function Wo(s,e){const t=e*(s.delayMinSeconds+s.delayMaxSeconds)*500,n=Math.random()*(s.delayMaxSeconds-s.delayMinSeconds)*1e3;return t+n}async function Jo(){const s=await G.getValue();if(!s.isRunning)return;const e=await Vo();if(!e){const t=await Te.getValue(),n=Date.now()-(t.lastScanAt||0),r=t.scanIntervalMinutes*60*1e3;n>=r&&(await jo(),await Ta());return}await G.setValue({...s,currentTaskId:e.id}),await ds(e.id,{status:"running"});try{await Xo(e),await ds(e.id,{status:"completed"});const t=await G.getValue();await G.setValue({...t,completedCount:t.completedCount+1,currentTaskId:void 0})}catch(t){console.error("Task execution failed:",t),await ds(e.id,{status:"failed"});const n=await G.getValue();await G.setValue({...n,failedCount:n.failedCount+1,currentTaskId:void 0})}}async function Xo(s){if(s.type==="scan_group"&&s.groupId){const t=(await ht.getValue()).find(n=>n.id===s.groupId);t&&chrome.runtime.sendMessage({type:"AUTOMATION_SCAN_GROUP",groupId:t.id,groupUrl:t.url})}}async function Yo(){const s=await Te.getValue(),e=await G.getValue(),t=e.queue.filter(n=>n.status==="pending"||n.status==="running");return{isRunning:e.isRunning,settings:s,state:e,pendingTasks:t}}async function zo(s){const e=await Te.getValue();await Te.setValue({...e,...s}),s.enabled!==void 0&&(s.enabled&&e.isPro?await Pa():s.enabled||await fs())}function Qo(s,e){const t=s+Math.random()*(e-s);return new Promise(n=>setTimeout(n,t))}async function Zo(s){try{await Qo(1e3,2e3);const e=await fetch(s,{credentials:"include",headers:{Accept:"text/html"}});if(!e.ok)return console.error("Failed to fetch profile:",e.status),null;const t=await e.text();return ec(t)}catch(e){return console.error("Error scraping profile:",e),null}}function ec(s){const e=new DOMParser().parseFromString(s,"text/html"),t={fetchedAt:Date.now(),confidenceScore:0};return t.profileName=tc(e),t.profileBio=nc(e),t.location=sc(e),t.workplace=rc(e),t.education=ac(e),t.recentActivity=ic(e),t.confidenceScore=oc(t),t}function tc(s){const e=['h1[data-testid="profile_name"]',"h1.x1heor9g",'[role="main"] h1',"title"];for(const t of e){const n=s.querySelector(t);if(n!=null&&n.textContent){const r=n.textContent.trim();if(r&&!r.includes("Facebook")&&r.length<100)return r}}}function nc(s){const e=['[data-testid="profile_intro_card_bio"]','[data-testid="intro_card_bio"]',".x1heor9g.x1qlqyl8.x1pd3egz"];for(const t of e){const n=s.querySelector(t);if(n!=null&&n.textContent){const r=n.textContent.trim();if(r&&r.length>5&&r.length<500)return r}}}function sc(s){var n;const e=[/Lives in (.+?)(?:\n|$)/i,/From (.+?)(?:\n|$)/i,/Located in (.+?)(?:\n|$)/i],t=((n=s.body)==null?void 0:n.textContent)||"";for(const r of e){const a=t.match(r);if(a!=null&&a[1]){const i=a[1].trim();if(i.length<100)return i}}}function rc(s){var n;const e=[/Works at (.+?)(?:\n|$)/i,/Worked at (.+?)(?:\n|$)/i,/(?:CEO|Founder|Owner|Manager|Director) (?:at|of) (.+?)(?:\n|$)/i],t=((n=s.body)==null?void 0:n.textContent)||"";for(const r of e){const a=t.match(r);if(a!=null&&a[1]){const i=a[1].trim();if(i.length<100)return i}}}function ac(s){var n;const e=[/Studied at (.+?)(?:\n|$)/i,/Went to (.+?)(?:\n|$)/i,/(?:University|College|School) of (.+?)(?:\n|$)/i],t=((n=s.body)==null?void 0:n.textContent)||"";for(const r of e){const a=t.match(r);if(a!=null&&a[1]){const i=a[1].trim();if(i.length<100)return i}}}function ic(s){const e=[];return s.querySelectorAll('[data-testid="post_message"], [data-ad-preview="message"]').forEach((n,r)=>{var i;if(r>=5)return;const a=(i=n.textContent)==null?void 0:i.trim();a&&a.length>10&&e.push({type:"post",text:a.substring(0,200),timestamp:Date.now()-r*864e5})}),e}function oc(s){var n,r;let e=0;const t=100;return s.profileName&&(e+=15),s.profileBio&&(e+=20),s.location&&(e+=15),s.workplace&&(e+=20),s.education&&(e+=10),s.recentActivity&&s.recentActivity.length>0&&(e+=10),s.interests&&s.interests.length>0&&(e+=5),((n=s.contactInfo)!=null&&n.email||(r=s.contactInfo)!=null&&r.website)&&(e+=5),Math.min(e,t)}async function cc(s,e){const t=await Zo(e);return{leadId:s,lci:t}}const lc=Ee(()=>{X.runtime.onInstalled.addListener(async()=>{const e=await X.storage.local.get("geminiApiKey");if(e.geminiApiKey){const t=await Ra.getValue();Oa(t.aiProvider,e.geminiApiKey)}}),X.runtime.onMessage.addListener((e,t,n)=>{var r;if(e.type==="OPEN_SIDEPANEL")return X.sidePanel.open({windowId:e.windowId}).catch(console.error),n({success:!0}),!0;if(e.type==="SET_API_KEY")return X.storage.local.set({[e.provider+"ApiKey"]:e.apiKey}),Oa(e.provider,e.apiKey),n({success:!0}),!0;if(e.type==="GET_API_KEY")return X.storage.local.get(e.provider+"ApiKey").then(a=>{n({apiKey:a[e.provider+"ApiKey"]})}),!0;if(e.type==="TRIGGER_MANUAL_SCAN"){const a=((r=t.tab)==null?void 0:r.id)||e.tabId;return a&&X.tabs.sendMessage(a,{type:"MANUAL_SCAN"}).then(i=>{n(i)}).catch(i=>{n({error:i.message})}),!0}if(e.type==="GET_SESSION_LIMITS")return Ia.getValue().then(a=>{n(a)}),!0;if(e.type==="RESET_SESSION_LIMITS")return Ia.setValue({maxPostsPerHour:e.maxPostsPerHour||30,maxGroupsPerDay:e.maxGroupsPerDay||10,cooldownMinutes:e.cooldownMinutes||15,postsScannedThisHour:0,groupsVisitedToday:0,lastHourReset:Date.now(),lastDayReset:new Date().toDateString(),isPaused:!1}).then(()=>{n({success:!0})}),!0;if(e.type==="GET_WATCHED_GROUPS")return ht.getValue().then(a=>{n(a)}),!0;if(e.type==="RECORD_GROUP_VISIT"){const{groupId:a,leadsFound:i}=e;return us(a,{lastVisited:Date.now(),leadsFound:i||0}).then(()=>{n({success:!0})}),!0}if(e.type==="OPEN_GROUP"){const{url:a,groupId:i}=e;return X.tabs.create({url:a}).then(o=>{i&&us(i,{lastVisited:Date.now()}),n({success:!0,tabId:o.id})}),!0}if(e.type==="BULK_GENERATE_REPLIES"){const{leadIds:a}=e;return s(a).then(()=>{n({success:!0})}).catch(i=>{n({error:i.message})}),!0}if(e.type==="GET_SCHEDULER_STATUS")return Yo().then(a=>{n(a)}),!0;if(e.type==="START_SCHEDULER")return Pa().then(()=>{n({success:!0})}).catch(a=>{n({error:a.message})}),!0;if(e.type==="STOP_SCHEDULER")return fs().then(()=>{n({success:!0})}).catch(a=>{n({error:a.message})}),!0;if(e.type==="UPDATE_AUTOMATION_SETTINGS"){const{settings:a}=e;return zo(a).then(()=>{n({success:!0})}).catch(i=>{n({error:i.message})}),!0}if(e.type==="AUTOMATION_SCAN_GROUP"){const{groupId:a,groupUrl:i}=e;return X.tabs.create({url:i,active:!1}).then(o=>{o.id&&setTimeout(()=>{X.tabs.sendMessage(o.id,{type:"MANUAL_SCAN"}).then(()=>{us(a,{lastVisited:Date.now()}),setTimeout(()=>{X.tabs.remove(o.id)},3e4)})},5e3),n({success:!0})}),!0}if(e.type==="FETCH_LEAD_LCI"){const{leadId:a}=e;return Ho(a).then(async i=>{if(!i){n({error:"Lead not found"});return}const o=await cc(a,i.authorProfileUrl);o.lci&&await Go(a,o.lci),n({success:!0,lci:o.lci})}).catch(i=>{n({error:i.message})}),!0}return!1});async function s(e){const t=await Do();if(!t)return;const r=(await Ko(e)).filter(i=>!i.aiDraftReply),a=await qe.getValue();for(const i of r)try{const o=await qo(i.postText,t),d=a.findIndex(h=>h.id===i.id);d>=0&&(a[d].aiDraftReply=o)}catch(o){console.error(`Failed to generate reply for lead ${i.id}:`,o)}await qe.setValue(a)}X.action.onClicked.addListener(async e=>{e.id&&await X.sidePanel.open({tabId:e.id})})});function mc(){}function Yt(s,...e){}const uc={debug:(...s)=>Yt(console.debug,...s),log:(...s)=>Yt(console.log,...s),warn:(...s)=>Yt(console.warn,...s),error:(...s)=>Yt(console.error,...s)};let hs;try{hs=lc.main(),hs instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(s){throw uc.error("The background crashed on startup!"),s}return hs})();
background;
